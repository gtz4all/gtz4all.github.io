
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="[[TOC]]">
      
      
        <meta name="author" content="Kervin Gtz">
      
      
        <link rel="canonical" href="https://gtz4all.github.io/cloud/aws/aws-ddns-ref/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.0, mkdocs-material-8.5.6">
    
    
      
        <title>AWS Tag Based Dynamic DNS - Gtz4All</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  
  
    
  
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Gtz4All - AWS Tag Based Dynamic DNS" />
  <meta property="og:description" content="Providing easy to deploy, reusable and automated solution for defining, provisioning and managing secure and scalable public and private cloud infrastructure environment. " />
  <meta property="og:url" content="https://gtz4all.github.io/cloud/aws/aws-ddns-ref/" />
  <meta property="og:image" content="<url>" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="deep-purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#vpc-dns" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Gtz4All" class="md-header__button md-logo" aria-label="Gtz4All" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Gtz4All
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              AWS Tag Based Dynamic DNS
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="deep-purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent="teal"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../intro/" class="md-tabs__link md-tabs__link--active">
        Cloud
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../devops/intro/" class="md-tabs__link">
        DevOps
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../networking/intro/" class="md-tabs__link">
        Networking
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../tips-tricks/intro/" class="md-tabs__link">
        Tips&Tricks
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../contact-us/intro/" class="md-tabs__link">
        Contact Us
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Gtz4All" class="md-nav__button md-logo" aria-label="Gtz4All" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5Z"/></svg>

    </a>
    Gtz4All
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Cloud
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Cloud" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Cloud
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_2">
          AWS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="AWS" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          AWS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          AWS Tag Based Dynamic DNS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        AWS Tag Based Dynamic DNS
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vpc-dns" class="md-nav__link">
    VPC DNS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#route53" class="md-nav__link">
    Route53
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#private-hosted-zone-requirements" class="md-nav__link">
    Private Hosted Zone Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#private-hosted-zone-records" class="md-nav__link">
    Private Hosted Zone Records
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reverse-lookup-zone-records" class="md-nav__link">
    Reverse Lookup Zone Records
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ec2-ddns-lambda" class="md-nav__link">
    EC2 DDNS Lambda
  </a>
  
    <nav class="md-nav" aria-label="EC2 DDNS Lambda">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ec2-ddns-lambda-flow" class="md-nav__link">
    EC2 DDNS Lambda Flow
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infrastructure-as-code" class="md-nav__link">
    Infrastructure as code
  </a>
  
    <nav class="md-nav" aria-label="Infrastructure as code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#terraform" class="md-nav__link">
    Terraform
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform-modules" class="md-nav__link">
    Terraform Modules
  </a>
  
    <nav class="md-nav" aria-label="Terraform Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#terraform-module-structure" class="md-nav__link">
    Terraform Module Structure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vpc-module" class="md-nav__link">
    VPC Module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgw-module" class="md-nav__link">
    TGW Module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#networking-module" class="md-nav__link">
    Networking Module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iam-module" class="md-nav__link">
    IAM Module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lambda-module" class="md-nav__link">
    Lambda Module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ec2-module" class="md-nav__link">
    EC2 Module
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ec2-tag-ddns-test-drive" class="md-nav__link">
    EC2 Tag DDNS Test Drive
  </a>
  
    <nav class="md-nav" aria-label="EC2 Tag DDNS Test Drive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-infrastructure" class="md-nav__link">
    Building Infrastructure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    Clean up
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cross-account-ec2-dynamic-dns" class="md-nav__link">
    Cross-Account EC2 Dynamic DNS
  </a>
  
    <nav class="md-nav" aria-label="Cross-Account EC2 Dynamic DNS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ec2-ddns-lambda-flow_1" class="md-nav__link">
    EC2 DDNS Lambda Flow
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../default-vpc-cleanup/" class="md-nav__link">
        Default Vpc Cleanup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ec2-dynamic-dns/" class="md-nav__link">
        EC2 Cross-Account Dynamic DNS Design
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../lambda-functions/" class="md-nav__link">
        Lambda Functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../three-tier-vpc/" class="md-nav__link">
        Three tier vpc
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_3">
          Azure
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Azure" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Azure
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure/azure-ngfw/" class="md-nav__link">
        Azure Firewall Notes
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure/azure-wan/" class="md-nav__link">
        Azure Virtual WAN Components
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure/landing-zones/" class="md-nav__link">
        Landing Zones
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure/mgmt-groups/" class="md-nav__link">
        Azure Management Groups
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure/networking/" class="md-nav__link">
        Azure Networking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure/tshoo/" class="md-nav__link">
        Azure Troubleshooting Notes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" type="checkbox" id="__nav_2_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_4">
          GCP
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="GCP" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          GCP
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gcp/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gcp/gcloud/" class="md-nav__link">
        Gcloud Command Overview
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          DevOps
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="DevOps" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          DevOps
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          Terraform
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Terraform" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Terraform
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/terraform/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/terraform/azure-auth/" class="md-nav__link">
        Terraform Azure Authentication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/terraform/google-secret-manager/" class="md-nav__link">
         Google Secret Manager
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/terraform/terraform-refactoring/" class="md-nav__link">
        Terraform State Refactoring
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_3">
          Ansible
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Ansible" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Ansible
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/ansible/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_4">
          Docker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Docker" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/docker/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/docker/hugo.docker.container/" class="md-nav__link">
        Building a Hugo Docker Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/docker/hugo.docker.troubleshooting/" class="md-nav__link">
        Working with Hugo Container
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5" type="checkbox" id="__nav_3_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_5">
          Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Kubernetes" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/kubernetes/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/kubernetes/kubernetes-cluster/" class="md-nav__link">
        Kubernetes Cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/kubernetes/kubernetes-deployments/" class="md-nav__link">
        Kubernetes Deployments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/kubernetes/kubernetes_services/" class="md-nav__link">
        Kubernetes Services
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_6" type="checkbox" id="__nav_3_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_6">
          Databases
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Databases" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Databases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/databases/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/databases/mongodb/" class="md-nav__link">
        MongoDB
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_7" type="checkbox" id="__nav_3_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_7">
          Web Services
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Web Services" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_7">
          <span class="md-nav__icon md-icon"></span>
          Web Services
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/webservices/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/webservices/environmentvars/" class="md-nav__link">
        Apache Environment Variables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/webservices/http-server-with-dynamic-content/" class="md-nav__link">
        HTTP Server with Dynamic Content
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Networking
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Networking" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Networking
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Arista
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Arista" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Arista
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/arista/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" type="checkbox" id="__nav_4_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_3">
          Cisco
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Cisco" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          Cisco
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/cisco/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Tips&Tricks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tips&Tricks" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Tips&Tricks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tips-tricks/intro/" class="md-nav__link">
        Tips and Tricks
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Contact Us
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Contact Us" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Contact Us
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../contact-us/intro/" class="md-nav__link">
        About Me
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#vpc-dns" class="md-nav__link">
    VPC DNS
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#route53" class="md-nav__link">
    Route53
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#private-hosted-zone-requirements" class="md-nav__link">
    Private Hosted Zone Requirements
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#private-hosted-zone-records" class="md-nav__link">
    Private Hosted Zone Records
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#reverse-lookup-zone-records" class="md-nav__link">
    Reverse Lookup Zone Records
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ec2-ddns-lambda" class="md-nav__link">
    EC2 DDNS Lambda
  </a>
  
    <nav class="md-nav" aria-label="EC2 DDNS Lambda">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ec2-ddns-lambda-flow" class="md-nav__link">
    EC2 DDNS Lambda Flow
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#infrastructure-as-code" class="md-nav__link">
    Infrastructure as code
  </a>
  
    <nav class="md-nav" aria-label="Infrastructure as code">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#terraform" class="md-nav__link">
    Terraform
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#terraform-modules" class="md-nav__link">
    Terraform Modules
  </a>
  
    <nav class="md-nav" aria-label="Terraform Modules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#terraform-module-structure" class="md-nav__link">
    Terraform Module Structure
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#vpc-module" class="md-nav__link">
    VPC Module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tgw-module" class="md-nav__link">
    TGW Module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#networking-module" class="md-nav__link">
    Networking Module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#iam-module" class="md-nav__link">
    IAM Module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lambda-module" class="md-nav__link">
    Lambda Module
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ec2-module" class="md-nav__link">
    EC2 Module
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ec2-tag-ddns-test-drive" class="md-nav__link">
    EC2 Tag DDNS Test Drive
  </a>
  
    <nav class="md-nav" aria-label="EC2 Tag DDNS Test Drive">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#requirements" class="md-nav__link">
    Requirements
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#building-infrastructure" class="md-nav__link">
    Building Infrastructure
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    Clean up
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cross-account-ec2-dynamic-dns" class="md-nav__link">
    Cross-Account EC2 Dynamic DNS
  </a>
  
    <nav class="md-nav" aria-label="Cross-Account EC2 Dynamic DNS">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#ec2-ddns-lambda-flow_1" class="md-nav__link">
    EC2 DDNS Lambda Flow
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>AWS Tag Based Dynamic DNS</h1>

<p>[[<em>TOC</em>]]</p>
<h4 id="vpc-dns">VPC DNS<a class="headerlink" href="#vpc-dns" title="Permanent link">&para;</a></h4>
<p>DNS provides a friendly name to refer to an EC2's IP Address. AWS already provides <a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-dns.html">DNS support for their VPC</a>. However, they have some limitations:</p>
<ul>
<li>AWS-provided private DNS hostnames are static domain names that take the form <code>ip-private-ipv4-address.ec2.internal</code> for the <code>us-east-1</code> Region and , and <code>ip-private-ipv4-address.region.compute.internal</code> for other Regions. </li>
<li>These private DNS hostnames are only accessible between instances in the same VPC. In a multi-VPC environment, instances can't resolve the DNS hostname outside the VPC that they are in.</li>
</ul>
<h4 id="route53">Route53<a class="headerlink" href="#route53" title="Permanent link">&para;</a></h4>
<p>Route53 can be used to create custom private hosted zones. <code>A private hosted zone is a container for one or more VPC Domain records.</code> By creating a private hosted zone for a domain (such as gtz4all.com), and then creating records, instances can query Route 53 to find out how traffic should be routed for that domain within their VPC and among others.</p>
<h4 id="private-hosted-zone-requirements">Private Hosted Zone Requirements<a class="headerlink" href="#private-hosted-zone-requirements" title="Permanent link">&para;</a></h4>
<p>For a private hosted zone to be accessible, there are multiple requirements.
for additional details, please refer to these links [Creating a private hosted zone]
* A VPC must be associated with the Private Hosted Zone
* The following VPC settings must be set to <code>true</code>
    * <code>enableDnsHostnames</code>
    * <code>enableDnsSupport</code>
* DHCP options sets
    * Valid <code>domain name`` (such as gtz4all.com)
    * domain-name-servers value:</code>AmazonProvidedDNS```</p>
<p>for additional details, please refer to these links 
* <a href="https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/hosted-zone-private-creating.html">Creating a private hosted zone</a>
* <a href="https://docs.aws.amazon.com/vpc/latest/userguide/VPC_DHCP_Options.html">DHCP options sets for your VPC</a></p>
<h4 id="private-hosted-zone-records">Private Hosted Zone Records<a class="headerlink" href="#private-hosted-zone-records" title="Permanent link">&para;</a></h4>
<p>*
* A(Address)record <code>A record</code> maps a hostname and a domain name to IP addresses. The value inside an A record can only be an <code>IP Address</code></p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Domain</th>
<th>A Record</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>ec2lab</td>
<td>gtz4all.com</td>
<td>ec2lab.gtz4all.com</td>
<td>10.168.0.10</td>
</tr>
</tbody>
</table>
<h4 id="reverse-lookup-zone-records">Reverse Lookup Zone Records<a class="headerlink" href="#reverse-lookup-zone-records" title="Permanent link">&para;</a></h4>
<ul>
<li>A reverse lookup zone is used primarily to resolve IP addresses to Address records. Reverse lookup Zones use a special root domain called in-and.</li>
<li>An IP address CIDR block reverse octet order is used to create a subdomain within the in-and.ARPA domain.</li>
</ul>
<table>
<thead>
<tr>
<th>VPC CIDR Block</th>
<th>Reverse Lookup Domain</th>
</tr>
</thead>
<tbody>
<tr>
<td>10.168.0.0/16</td>
<td>168.10.in-addr.arpa.</td>
</tr>
</tbody>
</table>
<ul>
<li>A DNS pointer record (PTR) provides the mapping of an IP address to a domain name. A DNS PTR record is the opposite of the 'A' record, which provides the IP address associated with a domain name.</li>
</ul>
<table>
<thead>
<tr>
<th>IP Address</th>
<th>Reverse Lookup Zone</th>
<th>PTR Record</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>10.168.0.10</td>
<td>168.10.in-addr.arpa.</td>
<td>10.0.168.10.in-addr.arpa.</td>
<td>ec2lab.gtz4all.com</td>
</tr>
</tbody>
</table>
<h2 id="ec2-ddns-lambda">EC2 DDNS Lambda<a class="headerlink" href="#ec2-ddns-lambda" title="Permanent link">&para;</a></h2>
<p><img alt="EC2 DDNS Lambda" src="img/single_account_dynamic_dns.jpg" /></p>
<p>This solution uses tagging as a way to interact with the users. </p>
<h6 id="overview">Overview<a class="headerlink" href="#overview" title="Permanent link">&para;</a></h6>
<pre class="mermaid"><code>graph TD
    A[ddns_lambda&lt;br&gt;core_ddns_lambda] --&gt;|assume role| B(sts_ddns_lambda)
    B --&gt; C{EC2}
    C --&gt;|Get Tag Value| D[DNSName]
    C --&gt;|Get VPC| E[SharedVPC]
    C --&gt;|Route53| F[A/PTR Records]
    C --&gt;|Update Tag| G[DDNS]</code></pre>
<ol>
<li>
<p>the users create a tag key <code>DNSName</code> with the <code>value</code> of their requested DNS name.</p>
<ul>
<li>DNSName: ec2lab</li>
<li>VPC, Private IP, State</li>
</ul>
</li>
<li>
<p>Lambda will pull resource DNSName Value to validate DNS Naming Standards</p>
<ul>
<li>valid DNS name Characters</li>
<li>Lambda will update the tag <code>DDNS</code> to notify users if they provided invalid characters</li>
</ul>
</li>
<li>
<p>Lambda will get the VPC attributes where the resource resides to validate if it is properly configured to support Route53.</p>
<ul>
<li><code>enableDnsHostnames</code>, <code>enableDnsSupport</code><ul>
<li>set to <code>true</code> if it isn't already</li>
</ul>
</li>
<li><code>domain-name</code>  and <code>AmazonProvidedDNS</code><ul>
<li><code>`domain name</code> is later used to create Private Hosted Zone if it doesn't already exist</li>
</ul>
</li>
<li>VPC CIDR Block<ul>
<li><code>VPC_CIDR_Block</code> is used to generate Reverse Zone Lookup and create if required.</li>
</ul>
</li>
</ul>
</li>
<li>
<p>Lambda will then go into multiple phases to find out if <code>` DNSName</code> value already exists or if it's unique</p>
<ul>
<li>Lambda will update tag <code>DDNS</code> to notify users if the provided <code>DNSName</code> value already exist </li>
<li>if the provided <code>DNSName</code> value is unique, <ul>
<li>A Record is created in the VPC's <code>domain name</code></li>
<li>PTR Record based on the resource <code>private ip</code> is created in the <code>VPC CIDR Block Reverse Lookup Zone</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p>DynamoDB DDNS</p>
</li>
<li>used to keep track of instance attributes and DNSName Changes</li>
<li>used to retrieve instance interface attributes when the instance has been terminated.</li>
</ol>
<h6 id="ec2-ddns-lambda-flow">EC2 DDNS Lambda Flow<a class="headerlink" href="#ec2-ddns-lambda-flow" title="Permanent link">&para;</a></h6>
<ul>
<li><img alt="EC2 DDNS Lambda Flow" src="/img/ddns_lambda_flow.jpg" /></li>
</ul>
<h2 id="infrastructure-as-code">Infrastructure as code<a class="headerlink" href="#infrastructure-as-code" title="Permanent link">&para;</a></h2>
<p>Infrastructure as code ( <code>IaC</code>) solves several problems with manual and static infrastructure management. IaC provides the ability to create and destroy an environment multiple times. This provides a way to version control and create an environment lifecycle where environmental changes can transition from development, testing, and production.</p>
<h4 id="terraform">Terraform<a class="headerlink" href="#terraform" title="Permanent link">&para;</a></h4>
<ul>
<li>Terraform is an IaC (Infrastructure as Code) tool used to build and modify infrastructure safely and efficiently. It keeps track of its environment state so rerunning the tool against a code with no changes will not generate any changes. </li>
</ul>
<h4 id="terraform-modules">Terraform Modules<a class="headerlink" href="#terraform-modules" title="Permanent link">&para;</a></h4>
<ul>
<li><a href="https://www.terraform.io/docs/language/modules/index.html">Terraform modules</a> can be used to create reusable code using terraform loop-like features such as <a href="https://www.terraform.io/docs/language/meta-arguments/count.html">count</a>.</li>
</ul>
<h6 id="terraform-module-structure">Terraform Module Structure<a class="headerlink" href="#terraform-module-structure" title="Permanent link">&para;</a></h6>
<div align="center">
![Terraform Design](/img/tf_structure.jpg)
</div>

<h4 id="vpc-module">VPC Module<a class="headerlink" href="#vpc-module" title="Permanent link">&para;</a></h4>
<ul>
<li>The VPC Module is used to build multiple Three Tier VPCs</li>
</ul>
<pre class="mermaid"><code>graph TD
subgraph A[Three Tier VPC1]
  subgraph B[Availability Zone 1]
    1[Public Subnet]
    2[Private Subnet]
    3[Local Subnet]
  end
  subgraph C[Availability Zone 2]
    4[Local Subnet]
    5[Private Subnet]
    6[Public Subnet]
  end
end
style 1 fill:#f5d5d5
style 2 fill:#e0ebff
style 3 fill:#d8e6d8
style 6 fill:#f5d5d5
style 5 fill:#e0ebff
style 4 fill:#d8e6d8
style A fill:#f5f5f5</code></pre>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="n">module</span> <span class="s2">&quot;vpc_build&quot;</span> <span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>  <span class="n">count</span>     <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">vpc_count</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>  <span class="n">source</span>    <span class="o">=</span> <span class="s2">&quot;./modules/vpc&quot;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a>  <span class="n">vpc_cidr</span>  <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">vpc_cidrs</span><span class="p">[</span><span class="n">count</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a>  <span class="n">vpc_name</span>  <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">vpc_names</span><span class="p">[</span><span class="n">count</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>  <span class="n">vpc_domain</span>  <span class="o">=</span> <span class="s2">&quot;$</span><span class="si">{var.vpc_names[count.index]}</span><span class="s2">.gtz4all.com&quot;</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="p">}</span>
</code></pre></div>
<h4 id="tgw-module">TGW Module<a class="headerlink" href="#tgw-module" title="Permanent link">&para;</a></h4>
<ul>
<li>This module builds the Transit Gateway and One route table 
<pre class="mermaid"><code>graph TD
subgraph D[Transit Gateway]
  subgraph E[Multi-VPC Route Table]
    7[Attachments] 
  end
end

style 7 fill:#e0ebff
style D fill:#f5f5f5</code></pre></li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">module</span> <span class="s2">&quot;tgw&quot;</span> <span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>  <span class="n">source</span>         <span class="o">=</span> <span class="s2">&quot;./modules/tgw&quot;</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a>  <span class="n">tgw_name</span>       <span class="o">=</span> <span class="s2">&quot;multi_vpc&quot;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="p">}</span>
</code></pre></div>
<h4 id="networking-module">Networking Module<a class="headerlink" href="#networking-module" title="Permanent link">&para;</a></h4>
<ul>
<li>This module is used to create VPC to TGW Connectivity which results in all VPCs being able to communicate with each other.</li>
</ul>
<p><pre class="mermaid"><code>graph TD

subgraph A[Three Tier VPC1]
  1[Availability Zone 1]
  2[Availability Zone 2]
end
subgraph B[Three Tier VPC2]
  3[Availability Zone 1]
  4[Availability Zone 2]
end
subgraph C[Three Tier VPC3]
  5[Availability Zone 1]
  6[Availability Zone 2]
end

subgraph D[Transit Gateway]
  subgraph E[Multi-VPC Route Table]
    7[VPC1 Attachment] --&gt; 1
    7[VPC1 Attachment] --&gt; 2
    8[VPC2 Attachment] --&gt; 3
    8[VPC2 Attachment] --&gt; 4
    9[VPC3 Attachment] --&gt; 5
    9[VPC4 Attachment] --&gt; 6
  end
end

style A fill:#f5f5f5
style B fill:#f5f5f5
style C fill:#f5f5f5
style D fill:#f5f5f5
style 1 fill:#d8e6d8
style 2 fill:#d8e6d8
style 3 fill:#d8e6d8
style 4 fill:#d8e6d8
style 5 fill:#d8e6d8
style 6 fill:#d8e6d8</code></pre>
* variables are being pass from the vpc and tgw to the root module which in turn passes those values to the networking module
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">module</span> <span class="s2">&quot;vpc_networking&quot;</span> <span class="p">{</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>  <span class="n">count</span>     <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">vpc_count</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>  <span class="n">source</span>          <span class="o">=</span> <span class="s2">&quot;./modules/networking&quot;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>  <span class="n">dest_cidr_block</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">vpc_to_tgw_dest_cidr</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>  <span class="n">tgw_id</span>          <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">tgw</span><span class="o">.</span><span class="n">tgw_id</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>  <span class="n">tgw_rt_id</span>       <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">tgw</span><span class="o">.</span><span class="n">tgw_rt_id</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a>  <span class="n">vpc_id</span>          <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">vpc_build</span><span class="p">[</span><span class="n">count</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">vpc_id</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>  <span class="n">vpc_name</span>        <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">vpc_names</span><span class="p">[</span><span class="n">count</span><span class="o">.</span><span class="n">index</span><span class="p">]</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a>  <span class="n">vpc_subnet0_id</span>  <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">vpc_build</span><span class="p">[</span><span class="n">count</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">local_subnet0_id</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>  <span class="n">vpc_subnet1_id</span>  <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">vpc_build</span><span class="p">[</span><span class="n">count</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">local_subnet1_id</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>  <span class="n">public_subnet_rt_id</span>  <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">vpc_build</span><span class="p">[</span><span class="n">count</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">public_rt_id</span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a>  <span class="n">private_subnet_rt_id</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">vpc_build</span><span class="p">[</span><span class="n">count</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">private_rt_id</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a>  <span class="n">local_subnet_rt_id</span>   <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">vpc_build</span><span class="p">[</span><span class="n">count</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">local_rt_id</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="p">}</span>
</code></pre></div></p>
<h4 id="iam-module">IAM Module<a class="headerlink" href="#iam-module" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>This module first creates the core_ddns_lambda role and policy. It then uses the core_ddns_lambda ARN to generate the sts_ddns_lambda policy which is associated with its corresponding role</p>
</li>
<li>
<p>it also creates a <a href="/iam/ec2-tag-restriction-policy.json">ec2_tag_restriction</a> policy</p>
</li>
<li>to maintain a healthy Route53 environment and be able to track Route53 Records correctly. Once the DNSName is created, it must remain for the lifetime of its resource. If the tag gets deleted, Lambda would not be able to perform route 53 clean up like deleted A and PTR records.</li>
<li>DDNS tag is used by lambda to update users on their DNS Name request. So users shouldn't be allowed to create or modify this tag.
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">  </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">      </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">          </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">              </span><span class="s2">&quot;ec2:DeleteTags&quot;</span><span class="w"></span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">          </span><span class="p">],</span><span class="w"></span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">          </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">              </span><span class="nt">&quot;ForAllValues:StringEquals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">                  </span><span class="nt">&quot;aws:TagKeys&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">                      </span><span class="s2">&quot;DNSName&quot;</span><span class="w"></span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">                  </span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">              </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a><span class="w">          </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">          </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Deny&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">          </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">          </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DenyDNSNameTagDeletion&quot;</span><span class="w"></span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="w">      </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="w">      </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="w">          </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="w">              </span><span class="s2">&quot;ec2:DeleteTags&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-3-21" name="__codelineno-3-21" href="#__codelineno-3-21"></a><span class="w">              </span><span class="s2">&quot;ec2:CreateTags&quot;</span><span class="w"></span>
<a id="__codelineno-3-22" name="__codelineno-3-22" href="#__codelineno-3-22"></a><span class="w">          </span><span class="p">],</span><span class="w"></span>
<a id="__codelineno-3-23" name="__codelineno-3-23" href="#__codelineno-3-23"></a><span class="w">          </span><span class="nt">&quot;Condition&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-24" name="__codelineno-3-24" href="#__codelineno-3-24"></a><span class="w">              </span><span class="nt">&quot;ForAllValues:StringEquals&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<a id="__codelineno-3-25" name="__codelineno-3-25" href="#__codelineno-3-25"></a><span class="w">                  </span><span class="nt">&quot;aws:TagKeys&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"></span>
<a id="__codelineno-3-26" name="__codelineno-3-26" href="#__codelineno-3-26"></a><span class="w">                      </span><span class="s2">&quot;DDNS&quot;</span><span class="w"></span>
<a id="__codelineno-3-27" name="__codelineno-3-27" href="#__codelineno-3-27"></a><span class="w">                  </span><span class="p">]</span><span class="w"></span>
<a id="__codelineno-3-28" name="__codelineno-3-28" href="#__codelineno-3-28"></a><span class="w">              </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-3-29" name="__codelineno-3-29" href="#__codelineno-3-29"></a><span class="w">          </span><span class="p">},</span><span class="w"></span>
<a id="__codelineno-3-30" name="__codelineno-3-30" href="#__codelineno-3-30"></a><span class="w">          </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Deny&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-3-31" name="__codelineno-3-31" href="#__codelineno-3-31"></a><span class="w">          </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;*&quot;</span><span class="p">,</span><span class="w"></span>
<a id="__codelineno-3-32" name="__codelineno-3-32" href="#__codelineno-3-32"></a><span class="w">          </span><span class="nt">&quot;Sid&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;DenyDDNSTagChanges&quot;</span><span class="w"></span>
<a id="__codelineno-3-33" name="__codelineno-3-33" href="#__codelineno-3-33"></a><span class="w">      </span><span class="p">}</span><span class="w"></span>
<a id="__codelineno-3-34" name="__codelineno-3-34" href="#__codelineno-3-34"></a><span class="w">  </span><span class="p">],</span><span class="w"></span>
<a id="__codelineno-3-35" name="__codelineno-3-35" href="#__codelineno-3-35"></a><span class="w">  </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="w"></span>
<a id="__codelineno-3-36" name="__codelineno-3-36" href="#__codelineno-3-36"></a><span class="p">}</span><span class="w"></span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="n">module</span> <span class="s2">&quot;iam_roles&quot;</span> <span class="p">{</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a>  <span class="n">source</span>         <span class="o">=</span> <span class="s2">&quot;./modules/iam&quot;</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="p">}</span>
</code></pre></div></li>
</ul>
<h4 id="lambda-module">Lambda Module<a class="headerlink" href="#lambda-module" title="Permanent link">&para;</a></h4>
<ul>
<li>This module builds a zip file which later is used to create the lambda function and its triggers.</li>
<li>Events are used to trigger the creation/deletion of Route53 resources<ul>
<li><code>aws.ec2</code> trigger is used to notify lambda about the creation or termination of an EC2. </li>
<li><code>aws.tag</code> trigger is used to notify lambda about the creation or modification of the "DNSName" tag. </li>
</ul>
</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="n">module</span> <span class="s2">&quot;ddns_lambda&quot;</span> <span class="p">{</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a>  <span class="n">source</span>         <span class="o">=</span> <span class="s2">&quot;./modules/lambda&quot;</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a>  <span class="n">ec2_tag_ddns_role_arn</span> <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">iam_roles</span><span class="o">.</span><span class="n">core_ddns_role_arn</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="p">}</span>
</code></pre></div>
<h4 id="ec2-module">EC2 Module<a class="headerlink" href="#ec2-module" title="Permanent link">&para;</a></h4>
<ul>
<li>This module is just to validate ec2_tag_ddns lambda environment</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="n">module</span> <span class="s2">&quot;ec2_ddns_lab&quot;</span> <span class="p">{</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>  <span class="n">count</span>             <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">vpc_count</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a>  <span class="n">source</span>            <span class="o">=</span> <span class="s2">&quot;./modules/ec2&quot;</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a>  <span class="n">vpc_id</span>            <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">vpc_build</span><span class="p">[</span><span class="n">count</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">vpc_id</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a>  <span class="n">public_subnet_id</span>  <span class="o">=</span> <span class="n">module</span><span class="o">.</span><span class="n">vpc_build</span><span class="p">[</span><span class="n">count</span><span class="o">.</span><span class="n">index</span><span class="p">]</span><span class="o">.</span><span class="n">public_subnet0_id</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>  <span class="n">ec2_name</span>          <span class="o">=</span> <span class="s2">&quot;$</span><span class="si">{var.vpc_names[count.index]}</span><span class="s2">-ddns-lab&quot;</span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="p">}</span>
</code></pre></div>
<h2 id="ec2-tag-ddns-test-drive">EC2 Tag DDNS Test Drive<a class="headerlink" href="#ec2-tag-ddns-test-drive" title="Permanent link">&para;</a></h2>
<h4 id="requirements">Requirements<a class="headerlink" href="#requirements" title="Permanent link">&para;</a></h4>
<ol>
<li><a href="https://learn.hashicorp.com/tutorials/terraform/install-cli">Install Terraform</a></li>
<li>Verify Terraform Installation<ul>
<li><code>terraform -help</code></li>
</ul>
</li>
<li><a href="https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2-linux.html">Install AWS CLI</a></li>
<li><a href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html">Configuring the AWS CLI</a></li>
<li>Verify AWS CLI Access<ul>
<li><code>aws ec2 describe-vpcs</code></li>
</ul>
</li>
</ol>
<h4 id="building-infrastructure">Building Infrastructure<a class="headerlink" href="#building-infrastructure" title="Permanent link">&para;</a></h4>
<ol>
<li>terraform init</li>
<li>terraform plan</li>
<li>terraform apply
    <div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">Do</span> <span class="n">you</span> <span class="n">want</span> <span class="n">to</span> <span class="n">perform</span> <span class="n">these</span> <span class="n">actions</span><span class="err">?</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>  <span class="n">Terraform</span> <span class="n">will</span> <span class="n">perform</span> <span class="n">the</span> <span class="n">actions</span> <span class="n">described</span> <span class="n">above</span><span class="o">.</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>  <span class="n">Only</span> <span class="s1">&#39;yes&#39;</span> <span class="n">will</span> <span class="n">be</span> <span class="n">accepted</span> <span class="n">to</span> <span class="n">approve</span><span class="o">.</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>  <span class="n">Enter</span> <span class="n">a</span> <span class="n">value</span><span class="p">:</span> <span class="n">yes</span>
</code></pre></div></li>
<li>Review the following Services<ul>
<li>VPC</li>
<li>EC2</li>
<li>Route53</li>
<li>DynamoDB</li>
<li>Lambda</li>
<li>IAM</li>
</ul>
</li>
<li>Update EC2 DNSName Value<ul>
<li>review DDNS Tag Value</li>
</ul>
</li>
<li>Terminate Instance<ul>
<li>Review DDNS Table and Route53 Private Hosted Zone and Reverse Zone Lookup</li>
</ul>
</li>
</ol>
<h4 id="clean-up">Clean up<a class="headerlink" href="#clean-up" title="Permanent link">&para;</a></h4>
<ol>
<li>
<p>terraform destroy
    <div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="n">Do</span> <span class="n">you</span> <span class="n">really</span> <span class="n">want</span> <span class="n">to</span> <span class="n">destroy</span> <span class="nb">all</span> <span class="n">resources</span><span class="err">?</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>  <span class="n">Terraform</span> <span class="n">will</span> <span class="n">destroy</span> <span class="nb">all</span> <span class="n">your</span> <span class="n">managed</span> <span class="n">infrastructure</span><span class="p">,</span> <span class="k">as</span> <span class="n">shown</span> <span class="n">above</span><span class="o">.</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>  <span class="n">There</span> <span class="ow">is</span> <span class="n">no</span> <span class="n">undo</span><span class="o">.</span> <span class="n">Only</span> <span class="s1">&#39;yes&#39;</span> <span class="n">will</span> <span class="n">be</span> <span class="n">accepted</span> <span class="n">to</span> <span class="n">confirm</span><span class="o">.</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>  <span class="n">Enter</span> <span class="n">a</span> <span class="n">value</span><span class="p">:</span> <span class="n">yes</span>
</code></pre></div></p>
</li>
<li>
<p>Resources built by EC2_TAG_DDNS_Lambda are not destroyed, they will need to be deleted <code>manually</code></p>
<ul>
<li>DynamoDB - DDNS</li>
<li>Private Hosted Zones</li>
<li>Reverse Lookup Zones</li>
</ul>
</li>
</ol>
<h2 id="cross-account-ec2-dynamic-dns">Cross-Account EC2 Dynamic DNS<a class="headerlink" href="#cross-account-ec2-dynamic-dns" title="Permanent link">&para;</a></h2>
<ul>
<li>This design can be used across multiple accounts using the follow AWS Features:</li>
<li><a href="https://docs.aws.amazon.com/vpc/latest/userguide/vpc-sharing.html">Shared VPCs</a></li>
<li><a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/events/CloudWatchEvents-CrossAccountEventDelivery.html">EventBridge Bus</a></li>
<li><a href="https://docs.aws.amazon.com/STS/latest/APIReference/API_AssumeRole.html">AssumeRole</a></li>
</ul>
<h6 id="ec2-ddns-lambda-flow_1">EC2 DDNS Lambda Flow<a class="headerlink" href="#ec2-ddns-lambda-flow_1" title="Permanent link">&para;</a></h6>
<h2 id="_1"><img alt="Cross Account EC2 DDNS Lambda Flow" src="/img/cross_account_dynamic_dns.jpg" /><a class="headerlink" href="#_1" title="Permanent link">&para;</a></h2>
<p><strong>NOTE</strong>
Currently working on a Module to take care of the steps below.</p>
<hr />
<ol>
<li>Share Subnets to a child account in your organization using [Resource Access Manager] (<a href="https://aws.amazon.com/blogs/networking-and-content-delivery/vpc-sharing-a-new-approach-to-multiple-accounts-and-vpc-management/">https://aws.amazon.com/blogs/networking-and-content-delivery/vpc-sharing-a-new-approach-to-multiple-accounts-and-vpc-management/</a>) </li>
<li>Create AssumeRole (sts)... see <a href="/modules/iam">IAM Module STS Role</a></li>
<li>Enable EventBus on <code>Network Account</code></li>
<li>Create aws.ec2 and aws.tag <a href="/modules/lambda/ec2_tag_event_trigger.tf">EventBridge Triggers</a> towards <code>Network Account</code> EventBus on <code>Child Account</code></li>
<li>Create Instance on child account with DNSName Tag</li>
</ol>
<script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../intro/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Introduction" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Introduction
            </div>
          </div>
        </a>
      
      
        
        <a href="../default-vpc-cleanup/" class="md-footer__link md-footer__link--next" aria-label="Next: Default Vpc Cleanup" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Default Vpc Cleanup
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright 2022 <a href='https://gtz4all.github.io'>Gtz4All</a>. All Rights Reserved.
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://gtz4all.github.io/" target="_blank" rel="noopener" title="gtz4all.github.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5Z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://github.com/gtz4all" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg>
    </a>
  
    
    
    <a href="gtz4all@gmail.com" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "header.autohide", "navigation.prune"], "search": "../../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.078830c0.min.js"></script>
      
    
  </body>
</html>