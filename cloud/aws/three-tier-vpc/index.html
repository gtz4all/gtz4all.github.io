
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="An AWS Three-Tier VPC Design provides a baseline to deploy software applications that consist of frontend, backend and database.This design provides Availability Zone High Availability and Fault Tolerant. In addition this design also provides the required topoligy for a highly secured environment.">
      
      
        <meta name="author" content="Kervin Gtz">
      
      
        <link rel="canonical" href="https://gtz4all.github.io/cloud/aws/three-tier-vpc/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.0, mkdocs-material-8.5.6">
    
    
      
        <title>Three tier vpc - Gtz4All</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.cbb835fc.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  
  
    
  
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Gtz4All - Three tier vpc" />
  <meta property="og:description" content="Providing easy to deploy, reusable and automated solution for defining, provisioning and managing secure and scalable public and private cloud infrastructure environment. " />
  <meta property="og:url" content="https://gtz4all.github.io/cloud/aws/three-tier-vpc/" />
  <meta property="og:image" content="<url>" />
  <meta property="og:image:type" content="image/png" />
  <meta property="og:image:width" content="1200" />
  <meta property="og:image:height" content="630" />

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="deep-purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#public-tier" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Gtz4All" class="md-header__button md-logo" aria-label="Gtz4All" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Gtz4All
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Three tier vpc
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="deep-purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent="teal"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../intro/" class="md-tabs__link md-tabs__link--active">
        Cloud
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../devops/intro/" class="md-tabs__link">
        DevOps
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../networking/intro/" class="md-tabs__link">
        Networking
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../tips-tricks/intro/" class="md-tabs__link">
        Tips&Tricks
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../contact-us/intro/" class="md-tabs__link">
        Contact Us
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Gtz4All" class="md-nav__button md-logo" aria-label="Gtz4All" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m19 2-5 4.5v11l5-4.5V2M6.5 5C4.55 5 2.45 5.4 1 6.5v14.66c0 .25.25.5.5.5.1 0 .15-.07.25-.07 1.35-.65 3.3-1.09 4.75-1.09 1.95 0 4.05.4 5.5 1.5 1.35-.85 3.8-1.5 5.5-1.5 1.65 0 3.35.31 4.75 1.06.1.05.15.03.25.03.25 0 .5-.25.5-.5V6.5c-.6-.45-1.25-.75-2-1V19c-1.1-.35-2.3-.5-3.5-.5-1.7 0-4.15.65-5.5 1.5V6.5C10.55 5.4 8.45 5 6.5 5Z"/></svg>

    </a>
    Gtz4All
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Cloud
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Cloud" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Cloud
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" type="checkbox" id="__nav_2_2" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_2_2">
          AWS
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="AWS" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          AWS
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../default-vpc-cleanup/" class="md-nav__link">
        Default Vpc Cleanup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../ec2-dynamic-dns/" class="md-nav__link">
        EC2 Cross-Account Dynamic DNS Design
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../lambda-functions/" class="md-nav__link">
        Lambda Functions
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../plugin-test/" class="md-nav__link">
        Plugin test
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Three tier vpc
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Three tier vpc
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#public-tier" class="md-nav__link">
    Public Tier
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#private-tier" class="md-nav__link">
    Private Tier
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#local-tier" class="md-nav__link">
    Local Tier
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloudformation" class="md-nav__link">
    Cloudformation
  </a>
  
    <nav class="md-nav" aria-label="Cloudformation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#componentes" class="md-nav__link">
    Componentes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#built-in-intrinsic-functions" class="md-nav__link">
    Built-in Intrinsic Functions
  </a>
  
    <nav class="md-nav" aria-label="Built-in Intrinsic Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fncidr-cidr" class="md-nav__link">
    Fn::Cidr ( !Cidr )
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fngetazs-getazs" class="md-nav__link">
    Fn::GetAZs (!GetAZs)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#three-tier-vpc-cloudformation-template" class="md-nav__link">
    Three Tier VPC Cloudformation Template
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" type="checkbox" id="__nav_2_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_3">
          Azure
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Azure" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          Azure
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure/landing-zones/" class="md-nav__link">
        Landing Zones
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure/mgmt-groups/" class="md-nav__link">
        Azure Management Groups
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure/networking/" class="md-nav__link">
        Azure Networking
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../azure/tshoo/" class="md-nav__link">
        Azure Troubleshooting Notes
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" type="checkbox" id="__nav_2_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2_4">
          GCP
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="GCP" data-md-level="2">
        <label class="md-nav__title" for="__nav_2_4">
          <span class="md-nav__icon md-icon"></span>
          GCP
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gcp/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../gcp/gcloud/" class="md-nav__link">
        Gcloud Command Overview
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          DevOps
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="DevOps" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          DevOps
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_2">
          Terraform
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Terraform" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Terraform
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/terraform/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_3" type="checkbox" id="__nav_3_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_3">
          Ansible
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Ansible" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_3">
          <span class="md-nav__icon md-icon"></span>
          Ansible
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/ansible/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_4" type="checkbox" id="__nav_3_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_4">
          Docker
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Docker" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_4">
          <span class="md-nav__icon md-icon"></span>
          Docker
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/docker/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/docker/hugo.docker.container/" class="md-nav__link">
        Building a Hugo Docker Containers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/docker/hugo.docker.troubleshooting/" class="md-nav__link">
        Working with Hugo Container
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_5" type="checkbox" id="__nav_3_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_5">
          Kubernetes
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Kubernetes" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          Kubernetes
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/kubernetes/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/kubernetes/kubernetes-cluster/" class="md-nav__link">
        Kubernetes Cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/kubernetes/kubernetes-deployments/" class="md-nav__link">
        Kubernetes Deployments
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/kubernetes/kubernetes_services/" class="md-nav__link">
        Kubernetes Services
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_6" type="checkbox" id="__nav_3_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_6">
          Databases
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Databases" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_6">
          <span class="md-nav__icon md-icon"></span>
          Databases
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/databases/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/databases/mongodb/" class="md-nav__link">
        MongoDB
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_7" type="checkbox" id="__nav_3_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3_7">
          Web Services
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Web Services" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_7">
          <span class="md-nav__icon md-icon"></span>
          Web Services
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/webservices/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/webservices/environmentvars/" class="md-nav__link">
        Apache Environment Variables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../devops/webservices/http-server-with-dynamic-content/" class="md-nav__link">
        HTTP Server with Dynamic Content
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Networking
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Networking" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Networking
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_2">
          Arista
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Arista" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Arista
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/arista/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_3" type="checkbox" id="__nav_4_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4_3">
          Cisco
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Cisco" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          Cisco
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../networking/cisco/intro/" class="md-nav__link">
        Introduction
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Tips&Tricks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tips&Tricks" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Tips&Tricks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../tips-tricks/intro/" class="md-nav__link">
        Tips and Tricks
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Contact Us
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Contact Us" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Contact Us
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../contact-us/intro/" class="md-nav__link">
        About Me
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../contact-us/aboutme/" class="md-nav__link">
        Aboutme
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#public-tier" class="md-nav__link">
    Public Tier
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#private-tier" class="md-nav__link">
    Private Tier
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#local-tier" class="md-nav__link">
    Local Tier
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloudformation" class="md-nav__link">
    Cloudformation
  </a>
  
    <nav class="md-nav" aria-label="Cloudformation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#componentes" class="md-nav__link">
    Componentes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#built-in-intrinsic-functions" class="md-nav__link">
    Built-in Intrinsic Functions
  </a>
  
    <nav class="md-nav" aria-label="Built-in Intrinsic Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#fncidr-cidr" class="md-nav__link">
    Fn::Cidr ( !Cidr )
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#fngetazs-getazs" class="md-nav__link">
    Fn::GetAZs (!GetAZs)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#three-tier-vpc-cloudformation-template" class="md-nav__link">
    Three Tier VPC Cloudformation Template
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Three tier vpc</h1>

<p>An AWS Three-Tier VPC Design provides a baseline to deploy software applications that consist of frontend, backend and database.This design provides Availability Zone High Availability and Fault Tolerant. In addition this design also provides the required topoligy for a highly secured environment.</p>
<p><img alt="three-tier-vpc-design.jpeg" src="../images/three-tier-vpc-design.jpeg" /></p>
<h4 id="public-tier">Public Tier<a class="headerlink" href="#public-tier" title="Permanent link">&para;</a></h4>
<p>The Public Tier has both inbound/outbound VPC External access. It is used to provide external services and an entry point into the environment</p>
<p><strong><em>Recommended Resources</em></strong>:
* Public Application Load Balancer
    Users will only be allowed to access application via public Application Load Balancer
* NAT Gateways
    Provides outbound access for private tier. This is required for software updates or patches
* Bastion Hosts
    A bastion host provides secure management access into all three tiers. These servers should be secured with MFA. </p>
<h4 id="private-tier">Private Tier<a class="headerlink" href="#private-tier" title="Permanent link">&para;</a></h4>
<p>The Private Tier only has outbound VPC External Access which is mainly used for software patches and updates. This is where the application servers and internal load balancer reside.</p>
<p><strong><em>Recommended Resources</em></strong>:
* Internal Application Load Balancer
    This type of ALBs and NLBs are used to provide a Highly Available Service to the Public Tier ALBs
* Application Servers
    EC2s, Lambda or EKS, ECS</p>
<h4 id="local-tier">Local Tier<a class="headerlink" href="#local-tier" title="Permanent link">&para;</a></h4>
<p>This tier does not have inbound/outbould VPC External Access. It is meant to host database services. Services inside this tier should only be access by the application services. </p>
<p><strong><em>Recommended Resources</em></strong>:
* Database Instances</p>
<h2 id="cloudformation">Cloudformation<a class="headerlink" href="#cloudformation" title="Permanent link">&para;</a></h2>
<p>Cloudformation is a tool to quickly and consistently deploy infrastructure by building the designed resources and managing them as stacks. it is a declarative programming language with some basic features specific to this use case.</p>
<h4 id="componentes">Componentes<a class="headerlink" href="#componentes" title="Permanent link">&para;</a></h4>
<ul>
<li>Metadata: </li>
</ul>
<p><code>AWS::CloudFormation::Interface</code> is used to modify how the AWS Cloudformation groups, labels and orders user input parameters.
  <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/metadata-section-structure.html">https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/metadata-section-structure.html</a> 
  <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nt">Metadata</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="l l-Scalar l-Scalar-Plain">AWS::CloudFormation::Interface</span><span class="p p-Indicator">:</span><span class="w"> </span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">  </span><span class="nt">ParameterGroups</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Label</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">        </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Availability</span><span class="nv"> </span><span class="s">Zones&quot;</span><span class="w"></span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">      </span><span class="nt">Parameters</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NumberOfAZs</span><span class="w"></span>
</code></pre></div>
* Parametes:</p>
<p>Parameters are used to request user input custom values which are later used by the <code>Resources</code> section to build infrastructure.
  <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/parameters-section-structure.html">https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/parameters-section-structure.html</a>
  <div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="nt">Parameters</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">  </span><span class="nt">NumberOfAZs</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Number</span><span class="w"></span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="nt">AllowedValues</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"></span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"></span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span><span class="nt">Default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"></span>
</code></pre></div></p>
<ul>
<li>Conditions:</li>
</ul>
<p>Conditions are used to set parameters based on other parameter's values provided by the user. These conditions are later used to set conditial resources. ex: If <code>Condition: Value</code> is true, create resource.
  <a href="https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/conditions-section-structure.html">https://docs.aws.amazon.com/AWSCloudFormation/latest/UserGuide/conditions-section-structure.html</a>
  <div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="c1">## Conditions are either True or False and are used to choose whether a rosource should be created or not. </span><span class="w"></span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="nt">Conditions</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">  </span><span class="c1">## Build4AZs is True if NumberofAZs is set to &#39;4&#39;</span><span class="w"></span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">  </span><span class="nt">Build4AZs</span><span class="p">:</span><span class="w">    </span><span class="kt">!Equals</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">NumberOfAZs</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">4</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">  </span><span class="c1">## Build4AZs is True if NumberofAZs is set to &#39;4&#39;</span><span class="w"></span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">  </span><span class="nt">ProdVPC</span><span class="p">:</span><span class="w">    </span><span class="kt">!Equals</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">Environment</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">prod</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">  </span><span class="c1">## BuildProdEnvironemt is True if both Build4AZs and ProdVPC are True</span><span class="w"></span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">  </span><span class="nt">BuildProdEnvironemt</span><span class="p">:</span><span class="w">   </span><span class="kt">!And</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Condition</span><span class="w"> </span><span class="nv">Build4AZs</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Condition</span><span class="w"> </span><span class="nv">ProdVPC</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"></span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="nt">Resources</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">  </span><span class="nt">PublicSubnet3</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet</span><span class="w"></span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="w">    </span><span class="c1">## PublicSubnet3 will be created only if Build4AZs is True</span><span class="w"></span>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span><span class="nt">Condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build4AZs</span><span class="w"></span>
</code></pre></div></p>
<h4 id="built-in-intrinsic-functions">Built-in Intrinsic Functions<a class="headerlink" href="#built-in-intrinsic-functions" title="Permanent link">&para;</a></h4>
<p>An intrinsic function used to perform a mathematical, character, or logical operation against a data item whose value is derived automatically during execution.</p>
<h6 id="fncidr-cidr">Fn::Cidr ( !Cidr )<a class="headerlink" href="#fncidr-cidr" title="Permanent link">&para;</a></h6>
<p>This Subnetting calculator function returns an CIDR address block list based on the <code>`count</code> provided. </p>
<p><code>!Cidr [ ipBlock, count, cidrBits ]</code></p>
<ul>
<li>
<p><strong><em>Parameters</em></strong></p>
<ul>
<li><code>ipBlock</code>: CIDR address block to be split into smaller CIDR blocks.</li>
<li><code>count</code>: The number of smaller CIDRs blocks to generate. Valid range 1 - 256.</li>
<li><code>cidrBits</code>: The number of subnet bits for the CIDR. </li>
</ul>
</li>
<li>
<p><strong><em>Example</em></strong></p>
<ul>
<li>Requirementes: create 12(count) /24s(cidrBits) out of a /16 (ipBlock) and pick the 6<sup>th</sup>(!Select) CIDR block.</li>
</ul>
</li>
</ul>
<table>
<tr>
<th>!Select [ 5, !Cidr [ "10.10.0.0/16", 12, 5 ]</th>
<th>Generated Table</th>
</tr>
<tr>
<td>

  - !Select - select the 6th block - starts from 0 - 7 if there are 8 blocks.

    ```!Select [ 5,``` 
  - !Cidr [CidrBlock = (/16),  12 = break /16 into 12 block, what size for each block? look at host-bits...

    ```!Cidr [ "10.10.0.0/16", 12,```
  - SubnetBits/cidrBits = 8 - which means host-bits of 8, (/24s)

    ```8]]```

***cidrBit Table***

Suffix|IPs|CIDR|Borrowed Bits|Binary
-|-|-|-|-
.255|1  |/32|0|11111111 
.254|2  |/31|1|11111110
.252|4  |/30|2|11111100
.248|8  |/29|3|11111000
.240|16 |/28|4|11110000
.224|32 |/27|5|11100000
.192|64 |/26|6|11000000
.128|128|/25|7|10000000
.0|256|/24|8|00000000

</td>
<td>    

Count|CidrBlocks|Select
-|-|-
0|10.10.0.0/24| 
1|10.10.1.0/24| 
2|10.10.2.0/24| 
3|10.10.3.0/24| 
4|10.10.4.0/24| 
5|10.10.5.0/24|!Select
6|10.10.6.0/24| 
7|10.10.7.0/24| 
8|10.10.8.0/24| 
9|10.10.9.0/24| 
10|10.10.10.0/24|
11|10.10.11.0/24|
12|10.10.12.0/24| 

</td>
</tr>
</table>

<ul>
<li><strong><em>Conditional Subnetting</em></strong>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!If</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">BuildProd</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">],</span><span class="w"> </span><span class="kt">!Cidr</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">CidrBlock</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!If</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">BuildProd</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">16</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">8</span><span class="p p-Indicator">],</span><span class="w"> </span><span class="kt">!If</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">BuildProd</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">5</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">6</span><span class="p p-Indicator">]]]</span><span class="w"></span>
</code></pre></div></li>
</ul>
<table>
<tr>
<th>Conditial !Cidr</th>
<th>Condition !if</th>
</tr>
<tr>
<td>

  - if BuildPord is True - Create 16 /27s (Host-Bits - 5 ) blocks
  - if BuildPord is False - Create 8 /26s (Host-Bits - 6 ) blocks 

    <div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!If</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">BuildProd</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">],</span><span class="w"> </span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="kt">!Cidr</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">CidrBlock</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!If</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">BuildProd</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">16</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">8</span><span class="p p-Indicator">],</span><span class="w"> </span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="kt">!If</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">BuildProd</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">5</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">6</span><span class="p p-Indicator">]]]</span><span class="w"></span>
</code></pre></div>

</td>
<td>

  !If Condition|Boolean|Value
  -|-|-
  BluidProd|True|firstValue
  BluidProd|False|secondValue

  ***!Cidr*** 

  ipBlock|count|cidrBits
  -|-|-
  !Ref CidrBlock|!If [BuildProd, 16, 8]|!If [BuildProd, 5, 6]

</td>
</tr>
</table>

<h6 id="fngetazs-getazs">Fn::GetAZs (!GetAZs)<a class="headerlink" href="#fngetazs-getazs" title="Permanent link">&para;</a></h6>
<p>The intrinsic function Fn::GetAZs returns a Availability Zone Name List based for a region. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a>AZ Name to AZ ID mapping is different per account.
</code></pre></div>
<ul>
<li><code>!GetAZs ""</code> in <code>us-east-1</code> returns a list of all Availability Zones: <code>[ "us-east-1a", "us-east-1b", "us-east-1c", "us-east-1d", "us-east-1e", "us-east-1f" ]</code> </li>
</ul>
<table>
<thead>
<tr>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
<th>5</th>
</tr>
</thead>
<tbody>
<tr>
<td>"us-east-1a"</td>
<td>"us-east-1b"</td>
<td>"us-east-1c"</td>
<td>"us-east-1d"</td>
<td>"us-east-1e"</td>
<td>"us-east-1f"</td>
</tr>
</tbody>
</table>
<ul>
<li><code>!Select</code> can pick an AZ based on the order list. </li>
</ul>
<p><code>!Select [3, !GetAZs '']</code> returns  <code>"us-east-1d"</code>.</p>
<h4 id="three-tier-vpc-cloudformation-template">Three Tier VPC Cloudformation Template<a class="headerlink" href="#three-tier-vpc-cloudformation-template" title="Permanent link">&para;</a></h4>
<p>This template builds the Three Tier VPC based on the above topology using the built-in cloudformation functions recently mentioned. </p>
<p><a href="../gtz4all-three-tier-vpc.yml">Gtz4all Three Tier VPC Template</a></p>
<div style="width:1200px;height:600px;overflow:auto;">

<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="nt">AWSTemplateFormatVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2010-09-09</span><span class="w"></span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GTZ Three Tier VPC Template</span><span class="w"></span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="nt">Metadata</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">AWS::CloudFormation::Interface</span><span class="p p-Indicator">:</span><span class="w"> </span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span><span class="nt">ParameterGroups</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Label</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">          </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Stack</span><span class="nv"> </span><span class="s">Name</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">--three-tier-vpc-cf</span><span class="nv"> </span><span class="s">(i.e</span><span class="nv"> </span><span class="s">jira-dev-three-tier-vpc-cf)&quot;</span><span class="w"></span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Label</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">          </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"></span>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Label</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">          </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;VPC</span><span class="nv"> </span><span class="s">Configuration&quot;</span><span class="w"></span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">        </span><span class="nt">Parameters</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ProjectName</span><span class="w"></span>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Environment</span><span class="w">          </span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CidrBlock</span><span class="w"></span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Label</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="w">          </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Subnet</span><span class="nv"> </span><span class="s">8</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">/24(/20</span><span class="nv"> </span><span class="s">CidrBlock</span><span class="nv"> </span><span class="s">Required),</span><span class="nv"> </span><span class="s">7</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">/25</span><span class="nv"> </span><span class="s">(/21</span><span class="nv"> </span><span class="s">CidrBlock</span><span class="nv"> </span><span class="s">Required),</span><span class="nv"> </span><span class="s">6</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">/26</span><span class="nv"> </span><span class="s">(/22</span><span class="nv"> </span><span class="s">CidrBlock</span><span class="nv"> </span><span class="s">Required)&quot;</span><span class="w"></span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="w">        </span><span class="nt">Parameters</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">SubnetBits</span><span class="w"></span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Label</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="w">          </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Availability</span><span class="nv"> </span><span class="s">Zones&quot;</span><span class="w"></span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="w">        </span><span class="nt">Parameters</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NumberOfAZs</span><span class="w"></span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="nt">Parameters</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="w">  </span><span class="nt">ProjectName</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="w">    </span><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Project Name ( ex. jira /  sfpt / sec )</span><span class="w"></span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">String</span><span class="w"></span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a><span class="w">  </span><span class="nt">CidrBlock</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="w">    </span><span class="nt">AllowedPattern</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])(\/(1[6-9]|2[0-8]))$</span><span class="w"></span>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a><span class="w">    </span><span class="nt">ConstraintDescription</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CIDR block parameter must be in the form x.x.x.x/16-28</span><span class="w"></span>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="w">    </span><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC valid IP CIDR Blocks /20&#39;s, /21&#39;s and /22&#39;s( ex. 10.168.0.0/20)</span><span class="w"></span>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a><span class="w">    </span><span class="nt">Default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.168.0.0/20</span><span class="w"></span>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">String</span><span class="w"></span>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a>
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a><span class="w">  </span><span class="nt">SubnetBits</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Number</span><span class="w"></span>
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a><span class="w">    </span><span class="nt">AllowedValues</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span><span class="w"></span>
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7</span><span class="w"></span>
<a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">6</span><span class="w"></span>
<a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a><span class="w">    </span><span class="nt">Default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8</span><span class="w"></span>
<a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a><span class="w">    </span><span class="nt">Description</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">Subnet Bits 8 = /24(/20 CidrBlock Required), 7 = /25 (/21 CidrBlock Required), 6 = /26 (/22 CidrBlock Required)</span><span class="w"></span>
<a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a>
<a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a><span class="w">  </span><span class="nt">NumberOfAZs</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Number</span><span class="w"></span>
<a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a><span class="w">    </span><span class="nt">AllowedValues</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"></span>
<a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"></span>
<a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a><span class="w">    </span><span class="nt">Default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"></span>
<a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a><span class="w">    </span><span class="nt">Description</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">Availability Zones - 2 = 2 per Tier, 4 = 4 per Tier</span><span class="w"></span>
<a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a>
<a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a><span class="w">  </span><span class="nt">Environment</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a><span class="w">    </span><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Choose VPC Type</span><span class="w"> </span>
<a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">String</span><span class="w"></span>
<a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a><span class="w">    </span><span class="nt">AllowedValues</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev</span><span class="w"></span>
<a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span><span class="w"></span>
<a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prod</span><span class="w"></span>
<a id="__codelineno-6-62" name="__codelineno-6-62" href="#__codelineno-6-62"></a>
<a id="__codelineno-6-63" name="__codelineno-6-63" href="#__codelineno-6-63"></a><span class="nt">Conditions</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-64" name="__codelineno-6-64" href="#__codelineno-6-64"></a><span class="w">  </span><span class="nt">Build4AZs</span><span class="p">:</span><span class="w">    </span><span class="kt">!Equals</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">NumberOfAZs</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">4</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"> </span>
<a id="__codelineno-6-65" name="__codelineno-6-65" href="#__codelineno-6-65"></a>
<a id="__codelineno-6-66" name="__codelineno-6-66" href="#__codelineno-6-66"></a><span class="c1">###############################################</span><span class="w"></span>
<a id="__codelineno-6-67" name="__codelineno-6-67" href="#__codelineno-6-67"></a><span class="c1">### Three Tier VPC                         ####</span><span class="w"></span>
<a id="__codelineno-6-68" name="__codelineno-6-68" href="#__codelineno-6-68"></a><span class="c1">###############################################  </span><span class="w"></span>
<a id="__codelineno-6-69" name="__codelineno-6-69" href="#__codelineno-6-69"></a><span class="nt">Resources</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-70" name="__codelineno-6-70" href="#__codelineno-6-70"></a><span class="w">  </span><span class="nt">VPC</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-71" name="__codelineno-6-71" href="#__codelineno-6-71"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::VPC</span><span class="w"></span>
<a id="__codelineno-6-72" name="__codelineno-6-72" href="#__codelineno-6-72"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-73" name="__codelineno-6-73" href="#__codelineno-6-73"></a><span class="w">      </span><span class="nt">CidrBlock</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">Ref</span><span class="p">:</span><span class="w"> </span><span class="nv">CidrBlock</span><span class="p p-Indicator">}</span><span class="w"></span>
<a id="__codelineno-6-74" name="__codelineno-6-74" href="#__codelineno-6-74"></a><span class="w">      </span><span class="nt">EnableDnsHostnames</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<a id="__codelineno-6-75" name="__codelineno-6-75" href="#__codelineno-6-75"></a><span class="w">      </span><span class="nt">EnableDnsSupport</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<a id="__codelineno-6-76" name="__codelineno-6-76" href="#__codelineno-6-76"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-77" name="__codelineno-6-77" href="#__codelineno-6-77"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-78" name="__codelineno-6-78" href="#__codelineno-6-78"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">Environment</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;three-tier&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;vpc&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-79" name="__codelineno-6-79" href="#__codelineno-6-79"></a>
<a id="__codelineno-6-80" name="__codelineno-6-80" href="#__codelineno-6-80"></a><span class="w">  </span><span class="nt">DhcpOptions</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-81" name="__codelineno-6-81" href="#__codelineno-6-81"></a><span class="w">      </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::DHCPOptions</span><span class="w"></span>
<a id="__codelineno-6-82" name="__codelineno-6-82" href="#__codelineno-6-82"></a><span class="w">      </span><span class="nt">Properties</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-83" name="__codelineno-6-83" href="#__codelineno-6-83"></a><span class="w">          </span><span class="nt">DomainName</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;three-tier.org&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-84" name="__codelineno-6-84" href="#__codelineno-6-84"></a><span class="w">          </span><span class="nt">DomainNameServers</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-85" name="__codelineno-6-85" href="#__codelineno-6-85"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AmazonProvidedDNS</span><span class="w"></span>
<a id="__codelineno-6-86" name="__codelineno-6-86" href="#__codelineno-6-86"></a><span class="w">          </span><span class="nt">Tags</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-87" name="__codelineno-6-87" href="#__codelineno-6-87"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-88" name="__codelineno-6-88" href="#__codelineno-6-88"></a><span class="w">              </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">Environment</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;three-tier&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;dopt&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-89" name="__codelineno-6-89" href="#__codelineno-6-89"></a>
<a id="__codelineno-6-90" name="__codelineno-6-90" href="#__codelineno-6-90"></a><span class="w">  </span><span class="nt">VPCDHCPOptionsAssociation</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-91" name="__codelineno-6-91" href="#__codelineno-6-91"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::VPCDHCPOptionsAssociation</span><span class="w"></span>
<a id="__codelineno-6-92" name="__codelineno-6-92" href="#__codelineno-6-92"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-93" name="__codelineno-6-93" href="#__codelineno-6-93"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">Ref</span><span class="p">:</span><span class="w"> </span><span class="nv">VPC</span><span class="p p-Indicator">}</span><span class="w"></span>
<a id="__codelineno-6-94" name="__codelineno-6-94" href="#__codelineno-6-94"></a><span class="w">      </span><span class="nt">DhcpOptionsId</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">Ref</span><span class="p">:</span><span class="w"> </span><span class="nv">DhcpOptions</span><span class="p p-Indicator">}</span><span class="w"></span>
<a id="__codelineno-6-95" name="__codelineno-6-95" href="#__codelineno-6-95"></a>
<a id="__codelineno-6-96" name="__codelineno-6-96" href="#__codelineno-6-96"></a><span class="w">  </span><span class="nt">InternetGateway</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-97" name="__codelineno-6-97" href="#__codelineno-6-97"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::InternetGateway</span><span class="w"></span>
<a id="__codelineno-6-98" name="__codelineno-6-98" href="#__codelineno-6-98"></a><span class="w">    </span><span class="nt">DependsOn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-6-99" name="__codelineno-6-99" href="#__codelineno-6-99"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-100" name="__codelineno-6-100" href="#__codelineno-6-100"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-101" name="__codelineno-6-101" href="#__codelineno-6-101"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-102" name="__codelineno-6-102" href="#__codelineno-6-102"></a><span class="w">        </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">Environment</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;three-tier&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;igw&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-103" name="__codelineno-6-103" href="#__codelineno-6-103"></a><span class="w">  </span><span class="nt">VPCGatewayAttachment</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-104" name="__codelineno-6-104" href="#__codelineno-6-104"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::VPCGatewayAttachment</span><span class="w"></span>
<a id="__codelineno-6-105" name="__codelineno-6-105" href="#__codelineno-6-105"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-106" name="__codelineno-6-106" href="#__codelineno-6-106"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-6-107" name="__codelineno-6-107" href="#__codelineno-6-107"></a><span class="w">      </span><span class="nt">InternetGatewayId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">InternetGateway</span><span class="w"></span>
<a id="__codelineno-6-108" name="__codelineno-6-108" href="#__codelineno-6-108"></a>
<a id="__codelineno-6-109" name="__codelineno-6-109" href="#__codelineno-6-109"></a><span class="c1">###############################################</span><span class="w"></span>
<a id="__codelineno-6-110" name="__codelineno-6-110" href="#__codelineno-6-110"></a><span class="c1">### Public/ALB Tier (inbound/outbound)     ####</span><span class="w"></span>
<a id="__codelineno-6-111" name="__codelineno-6-111" href="#__codelineno-6-111"></a><span class="c1">############################################### </span><span class="w"></span>
<a id="__codelineno-6-112" name="__codelineno-6-112" href="#__codelineno-6-112"></a><span class="w">  </span><span class="nt">PublicRouteTableA</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-113" name="__codelineno-6-113" href="#__codelineno-6-113"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::RouteTable</span><span class="w"></span>
<a id="__codelineno-6-114" name="__codelineno-6-114" href="#__codelineno-6-114"></a><span class="w">    </span><span class="nt">DependsOn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPCGatewayAttachment</span><span class="w"></span>
<a id="__codelineno-6-115" name="__codelineno-6-115" href="#__codelineno-6-115"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-116" name="__codelineno-6-116" href="#__codelineno-6-116"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-117" name="__codelineno-6-117" href="#__codelineno-6-117"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-118" name="__codelineno-6-118" href="#__codelineno-6-118"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;public&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;rt-1a&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-119" name="__codelineno-6-119" href="#__codelineno-6-119"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-6-120" name="__codelineno-6-120" href="#__codelineno-6-120"></a><span class="w">  </span><span class="nt">PublicRouteTableB</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-121" name="__codelineno-6-121" href="#__codelineno-6-121"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::RouteTable</span><span class="w"></span>
<a id="__codelineno-6-122" name="__codelineno-6-122" href="#__codelineno-6-122"></a><span class="w">    </span><span class="nt">DependsOn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPCGatewayAttachment</span><span class="w"></span>
<a id="__codelineno-6-123" name="__codelineno-6-123" href="#__codelineno-6-123"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-124" name="__codelineno-6-124" href="#__codelineno-6-124"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-125" name="__codelineno-6-125" href="#__codelineno-6-125"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-126" name="__codelineno-6-126" href="#__codelineno-6-126"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;public&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;rt-1b&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-127" name="__codelineno-6-127" href="#__codelineno-6-127"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w">       </span>
<a id="__codelineno-6-128" name="__codelineno-6-128" href="#__codelineno-6-128"></a><span class="c1">###############################################</span><span class="w"></span>
<a id="__codelineno-6-129" name="__codelineno-6-129" href="#__codelineno-6-129"></a><span class="w">  </span><span class="nt">PublicSubnet1</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-130" name="__codelineno-6-130" href="#__codelineno-6-130"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet</span><span class="w"></span>
<a id="__codelineno-6-131" name="__codelineno-6-131" href="#__codelineno-6-131"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-132" name="__codelineno-6-132" href="#__codelineno-6-132"></a><span class="w">      </span><span class="nt">AvailabilityZone</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!GetAZs</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p p-Indicator">]</span><span class="w"></span>
<a id="__codelineno-6-133" name="__codelineno-6-133" href="#__codelineno-6-133"></a><span class="w">      </span><span class="nt">CidrBlock</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Cidr</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">CidrBlock</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">12</span><span class="p p-Indicator">,</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">SubnetBits</span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-134" name="__codelineno-6-134" href="#__codelineno-6-134"></a><span class="w">      </span><span class="nt">MapPublicIpOnLaunch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<a id="__codelineno-6-135" name="__codelineno-6-135" href="#__codelineno-6-135"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-136" name="__codelineno-6-136" href="#__codelineno-6-136"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-137" name="__codelineno-6-137" href="#__codelineno-6-137"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;public&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;subnet-1a&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-138" name="__codelineno-6-138" href="#__codelineno-6-138"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-6-139" name="__codelineno-6-139" href="#__codelineno-6-139"></a><span class="w">  </span><span class="nt">PublicSubnet2</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-140" name="__codelineno-6-140" href="#__codelineno-6-140"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet</span><span class="w"></span>
<a id="__codelineno-6-141" name="__codelineno-6-141" href="#__codelineno-6-141"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-142" name="__codelineno-6-142" href="#__codelineno-6-142"></a><span class="w">      </span><span class="nt">AvailabilityZone</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!GetAZs</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p p-Indicator">]</span><span class="w">     </span>
<a id="__codelineno-6-143" name="__codelineno-6-143" href="#__codelineno-6-143"></a><span class="w">      </span><span class="nt">CidrBlock</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Cidr</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">CidrBlock</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">12</span><span class="p p-Indicator">,</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">SubnetBits</span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-144" name="__codelineno-6-144" href="#__codelineno-6-144"></a><span class="w">      </span><span class="nt">MapPublicIpOnLaunch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<a id="__codelineno-6-145" name="__codelineno-6-145" href="#__codelineno-6-145"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-146" name="__codelineno-6-146" href="#__codelineno-6-146"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-147" name="__codelineno-6-147" href="#__codelineno-6-147"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;public&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;subnet-1b&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-148" name="__codelineno-6-148" href="#__codelineno-6-148"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-6-149" name="__codelineno-6-149" href="#__codelineno-6-149"></a><span class="w">  </span><span class="nt">PublicSubnet3</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-150" name="__codelineno-6-150" href="#__codelineno-6-150"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet</span><span class="w"></span>
<a id="__codelineno-6-151" name="__codelineno-6-151" href="#__codelineno-6-151"></a><span class="w">    </span><span class="nt">Condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build4AZs</span><span class="w"></span>
<a id="__codelineno-6-152" name="__codelineno-6-152" href="#__codelineno-6-152"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-153" name="__codelineno-6-153" href="#__codelineno-6-153"></a><span class="w">      </span><span class="nt">AvailabilityZone</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!GetAZs</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p p-Indicator">]</span><span class="w"></span>
<a id="__codelineno-6-154" name="__codelineno-6-154" href="#__codelineno-6-154"></a><span class="w">      </span><span class="nt">CidrBlock</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Cidr</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">CidrBlock</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">12</span><span class="p p-Indicator">,</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">SubnetBits</span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-155" name="__codelineno-6-155" href="#__codelineno-6-155"></a><span class="w">      </span><span class="nt">MapPublicIpOnLaunch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<a id="__codelineno-6-156" name="__codelineno-6-156" href="#__codelineno-6-156"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-157" name="__codelineno-6-157" href="#__codelineno-6-157"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-158" name="__codelineno-6-158" href="#__codelineno-6-158"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;public&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;subnet-1c&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-159" name="__codelineno-6-159" href="#__codelineno-6-159"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-6-160" name="__codelineno-6-160" href="#__codelineno-6-160"></a><span class="w">  </span><span class="nt">PublicSubnet4</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-161" name="__codelineno-6-161" href="#__codelineno-6-161"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet</span><span class="w"></span>
<a id="__codelineno-6-162" name="__codelineno-6-162" href="#__codelineno-6-162"></a><span class="w">    </span><span class="nt">Condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build4AZs</span><span class="w"></span>
<a id="__codelineno-6-163" name="__codelineno-6-163" href="#__codelineno-6-163"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-164" name="__codelineno-6-164" href="#__codelineno-6-164"></a><span class="w">      </span><span class="nt">AvailabilityZone</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!GetAZs</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p p-Indicator">]</span><span class="w">     </span>
<a id="__codelineno-6-165" name="__codelineno-6-165" href="#__codelineno-6-165"></a><span class="w">      </span><span class="nt">CidrBlock</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Cidr</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">CidrBlock</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">12</span><span class="p p-Indicator">,</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">SubnetBits</span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-166" name="__codelineno-6-166" href="#__codelineno-6-166"></a><span class="w">      </span><span class="nt">MapPublicIpOnLaunch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<a id="__codelineno-6-167" name="__codelineno-6-167" href="#__codelineno-6-167"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-168" name="__codelineno-6-168" href="#__codelineno-6-168"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-169" name="__codelineno-6-169" href="#__codelineno-6-169"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;public&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;subnet-1d&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-170" name="__codelineno-6-170" href="#__codelineno-6-170"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-6-171" name="__codelineno-6-171" href="#__codelineno-6-171"></a><span class="c1">###############################################</span><span class="w"></span>
<a id="__codelineno-6-172" name="__codelineno-6-172" href="#__codelineno-6-172"></a><span class="w">  </span><span class="nt">PublicSubnetAssoc1</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-173" name="__codelineno-6-173" href="#__codelineno-6-173"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::SubnetRouteTableAssociation</span><span class="w"></span>
<a id="__codelineno-6-174" name="__codelineno-6-174" href="#__codelineno-6-174"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-175" name="__codelineno-6-175" href="#__codelineno-6-175"></a><span class="w">      </span><span class="nt">RouteTableId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PublicRouteTableA</span><span class="w"></span>
<a id="__codelineno-6-176" name="__codelineno-6-176" href="#__codelineno-6-176"></a><span class="w">      </span><span class="nt">SubnetId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PublicSubnet1</span><span class="w"></span>
<a id="__codelineno-6-177" name="__codelineno-6-177" href="#__codelineno-6-177"></a><span class="w">  </span><span class="nt">PublicSubnetAssoc2</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-178" name="__codelineno-6-178" href="#__codelineno-6-178"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::SubnetRouteTableAssociation</span><span class="w"></span>
<a id="__codelineno-6-179" name="__codelineno-6-179" href="#__codelineno-6-179"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-180" name="__codelineno-6-180" href="#__codelineno-6-180"></a><span class="w">      </span><span class="nt">RouteTableId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PublicRouteTableB</span><span class="w"></span>
<a id="__codelineno-6-181" name="__codelineno-6-181" href="#__codelineno-6-181"></a><span class="w">      </span><span class="nt">SubnetId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PublicSubnet2</span><span class="w"></span>
<a id="__codelineno-6-182" name="__codelineno-6-182" href="#__codelineno-6-182"></a><span class="w">  </span><span class="nt">PublicSubnetAssoc3</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-183" name="__codelineno-6-183" href="#__codelineno-6-183"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::SubnetRouteTableAssociation</span><span class="w"></span>
<a id="__codelineno-6-184" name="__codelineno-6-184" href="#__codelineno-6-184"></a><span class="w">    </span><span class="nt">Condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build4AZs</span><span class="w"></span>
<a id="__codelineno-6-185" name="__codelineno-6-185" href="#__codelineno-6-185"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-186" name="__codelineno-6-186" href="#__codelineno-6-186"></a><span class="w">      </span><span class="nt">RouteTableId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PublicRouteTableA</span><span class="w"></span>
<a id="__codelineno-6-187" name="__codelineno-6-187" href="#__codelineno-6-187"></a><span class="w">      </span><span class="nt">SubnetId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PublicSubnet3</span><span class="w"></span>
<a id="__codelineno-6-188" name="__codelineno-6-188" href="#__codelineno-6-188"></a><span class="w">  </span><span class="nt">PublicSubnetAssoc4</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-189" name="__codelineno-6-189" href="#__codelineno-6-189"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::SubnetRouteTableAssociation</span><span class="w"></span>
<a id="__codelineno-6-190" name="__codelineno-6-190" href="#__codelineno-6-190"></a><span class="w">    </span><span class="nt">Condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build4AZs</span><span class="w"></span>
<a id="__codelineno-6-191" name="__codelineno-6-191" href="#__codelineno-6-191"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-192" name="__codelineno-6-192" href="#__codelineno-6-192"></a><span class="w">      </span><span class="nt">RouteTableId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PublicRouteTableB</span><span class="w"></span>
<a id="__codelineno-6-193" name="__codelineno-6-193" href="#__codelineno-6-193"></a><span class="w">      </span><span class="nt">SubnetId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PublicSubnet4</span><span class="w"></span>
<a id="__codelineno-6-194" name="__codelineno-6-194" href="#__codelineno-6-194"></a>
<a id="__codelineno-6-195" name="__codelineno-6-195" href="#__codelineno-6-195"></a><span class="c1">###############################################</span><span class="w"></span>
<a id="__codelineno-6-196" name="__codelineno-6-196" href="#__codelineno-6-196"></a><span class="c1">### Private/Application Tier (inbound)     ####</span><span class="w"></span>
<a id="__codelineno-6-197" name="__codelineno-6-197" href="#__codelineno-6-197"></a><span class="c1">############################################### </span><span class="w"></span>
<a id="__codelineno-6-198" name="__codelineno-6-198" href="#__codelineno-6-198"></a><span class="w">  </span><span class="nt">AppRouteTableA</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-199" name="__codelineno-6-199" href="#__codelineno-6-199"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::RouteTable</span><span class="w"></span>
<a id="__codelineno-6-200" name="__codelineno-6-200" href="#__codelineno-6-200"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-201" name="__codelineno-6-201" href="#__codelineno-6-201"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-202" name="__codelineno-6-202" href="#__codelineno-6-202"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-203" name="__codelineno-6-203" href="#__codelineno-6-203"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;private&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;rt-1a&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-204" name="__codelineno-6-204" href="#__codelineno-6-204"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-205" name="__codelineno-6-205" href="#__codelineno-6-205"></a><span class="w">        </span><span class="nt">Ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-6-206" name="__codelineno-6-206" href="#__codelineno-6-206"></a><span class="w">  </span><span class="nt">AppRouteTableB</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-207" name="__codelineno-6-207" href="#__codelineno-6-207"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::RouteTable</span><span class="w"></span>
<a id="__codelineno-6-208" name="__codelineno-6-208" href="#__codelineno-6-208"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-209" name="__codelineno-6-209" href="#__codelineno-6-209"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-210" name="__codelineno-6-210" href="#__codelineno-6-210"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-211" name="__codelineno-6-211" href="#__codelineno-6-211"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;private&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;rt-1b&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-212" name="__codelineno-6-212" href="#__codelineno-6-212"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-213" name="__codelineno-6-213" href="#__codelineno-6-213"></a><span class="w">        </span><span class="nt">Ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w">        </span>
<a id="__codelineno-6-214" name="__codelineno-6-214" href="#__codelineno-6-214"></a><span class="c1">###############################################</span><span class="w"></span>
<a id="__codelineno-6-215" name="__codelineno-6-215" href="#__codelineno-6-215"></a><span class="w">  </span><span class="nt">AppSubnet1</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-216" name="__codelineno-6-216" href="#__codelineno-6-216"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet</span><span class="w"></span>
<a id="__codelineno-6-217" name="__codelineno-6-217" href="#__codelineno-6-217"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-218" name="__codelineno-6-218" href="#__codelineno-6-218"></a><span class="w">      </span><span class="nt">AvailabilityZone</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!GetAZs</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p p-Indicator">]</span><span class="w"></span>
<a id="__codelineno-6-219" name="__codelineno-6-219" href="#__codelineno-6-219"></a><span class="w">      </span><span class="nt">CidrBlock</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">4</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Cidr</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">CidrBlock</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">12</span><span class="p p-Indicator">,</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">SubnetBits</span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-220" name="__codelineno-6-220" href="#__codelineno-6-220"></a><span class="w">      </span><span class="nt">MapPublicIpOnLaunch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<a id="__codelineno-6-221" name="__codelineno-6-221" href="#__codelineno-6-221"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-222" name="__codelineno-6-222" href="#__codelineno-6-222"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-223" name="__codelineno-6-223" href="#__codelineno-6-223"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;private&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;subnet-1a&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-224" name="__codelineno-6-224" href="#__codelineno-6-224"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-6-225" name="__codelineno-6-225" href="#__codelineno-6-225"></a><span class="w">  </span><span class="nt">AppSubnet2</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-226" name="__codelineno-6-226" href="#__codelineno-6-226"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet</span><span class="w"></span>
<a id="__codelineno-6-227" name="__codelineno-6-227" href="#__codelineno-6-227"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-228" name="__codelineno-6-228" href="#__codelineno-6-228"></a><span class="w">      </span><span class="nt">AvailabilityZone</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!GetAZs</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p p-Indicator">]</span><span class="w">     </span>
<a id="__codelineno-6-229" name="__codelineno-6-229" href="#__codelineno-6-229"></a><span class="w">      </span><span class="nt">CidrBlock</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">5</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Cidr</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">CidrBlock</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">12</span><span class="p p-Indicator">,</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">SubnetBits</span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-230" name="__codelineno-6-230" href="#__codelineno-6-230"></a><span class="w">      </span><span class="nt">MapPublicIpOnLaunch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<a id="__codelineno-6-231" name="__codelineno-6-231" href="#__codelineno-6-231"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-232" name="__codelineno-6-232" href="#__codelineno-6-232"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-233" name="__codelineno-6-233" href="#__codelineno-6-233"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;private&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;subnet-1b&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-234" name="__codelineno-6-234" href="#__codelineno-6-234"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-6-235" name="__codelineno-6-235" href="#__codelineno-6-235"></a><span class="w">  </span><span class="nt">AppSubnet3</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-236" name="__codelineno-6-236" href="#__codelineno-6-236"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet</span><span class="w"></span>
<a id="__codelineno-6-237" name="__codelineno-6-237" href="#__codelineno-6-237"></a><span class="w">    </span><span class="nt">Condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build4AZs</span><span class="w"></span>
<a id="__codelineno-6-238" name="__codelineno-6-238" href="#__codelineno-6-238"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-239" name="__codelineno-6-239" href="#__codelineno-6-239"></a><span class="w">      </span><span class="nt">AvailabilityZone</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!GetAZs</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p p-Indicator">]</span><span class="w"></span>
<a id="__codelineno-6-240" name="__codelineno-6-240" href="#__codelineno-6-240"></a><span class="w">      </span><span class="nt">CidrBlock</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">6</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Cidr</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">CidrBlock</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">12</span><span class="p p-Indicator">,</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">SubnetBits</span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-241" name="__codelineno-6-241" href="#__codelineno-6-241"></a><span class="w">      </span><span class="nt">MapPublicIpOnLaunch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<a id="__codelineno-6-242" name="__codelineno-6-242" href="#__codelineno-6-242"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-243" name="__codelineno-6-243" href="#__codelineno-6-243"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-244" name="__codelineno-6-244" href="#__codelineno-6-244"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;private&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;subnet-1c&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-245" name="__codelineno-6-245" href="#__codelineno-6-245"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-6-246" name="__codelineno-6-246" href="#__codelineno-6-246"></a><span class="w">  </span><span class="nt">AppSubnet4</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-247" name="__codelineno-6-247" href="#__codelineno-6-247"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet</span><span class="w"></span>
<a id="__codelineno-6-248" name="__codelineno-6-248" href="#__codelineno-6-248"></a><span class="w">    </span><span class="nt">Condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build4AZs</span><span class="w"></span>
<a id="__codelineno-6-249" name="__codelineno-6-249" href="#__codelineno-6-249"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-250" name="__codelineno-6-250" href="#__codelineno-6-250"></a><span class="w">      </span><span class="nt">AvailabilityZone</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!GetAZs</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p p-Indicator">]</span><span class="w">     </span>
<a id="__codelineno-6-251" name="__codelineno-6-251" href="#__codelineno-6-251"></a><span class="w">      </span><span class="nt">CidrBlock</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">7</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Cidr</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">CidrBlock</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">12</span><span class="p p-Indicator">,</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">SubnetBits</span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-252" name="__codelineno-6-252" href="#__codelineno-6-252"></a><span class="w">      </span><span class="nt">MapPublicIpOnLaunch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<a id="__codelineno-6-253" name="__codelineno-6-253" href="#__codelineno-6-253"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-254" name="__codelineno-6-254" href="#__codelineno-6-254"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-255" name="__codelineno-6-255" href="#__codelineno-6-255"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;private&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;subnet-1d&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-256" name="__codelineno-6-256" href="#__codelineno-6-256"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-6-257" name="__codelineno-6-257" href="#__codelineno-6-257"></a><span class="c1">###############################################</span><span class="w"></span>
<a id="__codelineno-6-258" name="__codelineno-6-258" href="#__codelineno-6-258"></a><span class="w">  </span><span class="nt">AppSubnetAssoc1</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-259" name="__codelineno-6-259" href="#__codelineno-6-259"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::SubnetRouteTableAssociation</span><span class="w"></span>
<a id="__codelineno-6-260" name="__codelineno-6-260" href="#__codelineno-6-260"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-261" name="__codelineno-6-261" href="#__codelineno-6-261"></a><span class="w">      </span><span class="nt">RouteTableId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AppRouteTableA</span><span class="w"></span>
<a id="__codelineno-6-262" name="__codelineno-6-262" href="#__codelineno-6-262"></a><span class="w">      </span><span class="nt">SubnetId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AppSubnet1</span><span class="w"></span>
<a id="__codelineno-6-263" name="__codelineno-6-263" href="#__codelineno-6-263"></a><span class="w">  </span><span class="nt">AppSubnetAssoc2</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-264" name="__codelineno-6-264" href="#__codelineno-6-264"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::SubnetRouteTableAssociation</span><span class="w"></span>
<a id="__codelineno-6-265" name="__codelineno-6-265" href="#__codelineno-6-265"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-266" name="__codelineno-6-266" href="#__codelineno-6-266"></a><span class="w">      </span><span class="nt">RouteTableId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AppRouteTableB</span><span class="w"></span>
<a id="__codelineno-6-267" name="__codelineno-6-267" href="#__codelineno-6-267"></a><span class="w">      </span><span class="nt">SubnetId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AppSubnet2</span><span class="w"></span>
<a id="__codelineno-6-268" name="__codelineno-6-268" href="#__codelineno-6-268"></a><span class="w">  </span><span class="nt">AppSubnetAssoc3</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-269" name="__codelineno-6-269" href="#__codelineno-6-269"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::SubnetRouteTableAssociation</span><span class="w"></span>
<a id="__codelineno-6-270" name="__codelineno-6-270" href="#__codelineno-6-270"></a><span class="w">    </span><span class="nt">Condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build4AZs</span><span class="w"></span>
<a id="__codelineno-6-271" name="__codelineno-6-271" href="#__codelineno-6-271"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-272" name="__codelineno-6-272" href="#__codelineno-6-272"></a><span class="w">      </span><span class="nt">RouteTableId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AppRouteTableA</span><span class="w"></span>
<a id="__codelineno-6-273" name="__codelineno-6-273" href="#__codelineno-6-273"></a><span class="w">      </span><span class="nt">SubnetId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AppSubnet3</span><span class="w"></span>
<a id="__codelineno-6-274" name="__codelineno-6-274" href="#__codelineno-6-274"></a><span class="w">  </span><span class="nt">AppSubnetAssoc4</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-275" name="__codelineno-6-275" href="#__codelineno-6-275"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::SubnetRouteTableAssociation</span><span class="w"></span>
<a id="__codelineno-6-276" name="__codelineno-6-276" href="#__codelineno-6-276"></a><span class="w">    </span><span class="nt">Condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build4AZs</span><span class="w"></span>
<a id="__codelineno-6-277" name="__codelineno-6-277" href="#__codelineno-6-277"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-278" name="__codelineno-6-278" href="#__codelineno-6-278"></a><span class="w">      </span><span class="nt">RouteTableId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AppRouteTableB</span><span class="w"></span>
<a id="__codelineno-6-279" name="__codelineno-6-279" href="#__codelineno-6-279"></a><span class="w">      </span><span class="nt">SubnetId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AppSubnet4</span><span class="w"></span>
<a id="__codelineno-6-280" name="__codelineno-6-280" href="#__codelineno-6-280"></a><span class="c1">###############################################</span><span class="w"></span>
<a id="__codelineno-6-281" name="__codelineno-6-281" href="#__codelineno-6-281"></a><span class="w">  </span><span class="nt">NatGatewayAEIP</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-282" name="__codelineno-6-282" href="#__codelineno-6-282"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;AWS::EC2::EIP&#39;</span><span class="w"></span>
<a id="__codelineno-6-283" name="__codelineno-6-283" href="#__codelineno-6-283"></a><span class="w">    </span><span class="nt">DependsOn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPCGatewayAttachment</span><span class="w">  </span>
<a id="__codelineno-6-284" name="__codelineno-6-284" href="#__codelineno-6-284"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-285" name="__codelineno-6-285" href="#__codelineno-6-285"></a><span class="w">      </span><span class="nt">Domain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vpc</span><span class="w"></span>
<a id="__codelineno-6-286" name="__codelineno-6-286" href="#__codelineno-6-286"></a><span class="w">  </span><span class="nt">NatGatewayA</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-287" name="__codelineno-6-287" href="#__codelineno-6-287"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;AWS::EC2::NatGateway&#39;</span><span class="w"></span>
<a id="__codelineno-6-288" name="__codelineno-6-288" href="#__codelineno-6-288"></a><span class="w">    </span><span class="nt">DependsOn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NatGatewayAEIP</span><span class="w">  </span>
<a id="__codelineno-6-289" name="__codelineno-6-289" href="#__codelineno-6-289"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-290" name="__codelineno-6-290" href="#__codelineno-6-290"></a><span class="w">      </span><span class="nt">AllocationId</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-291" name="__codelineno-6-291" href="#__codelineno-6-291"></a><span class="w">          </span><span class="l l-Scalar l-Scalar-Plain">Fn::GetAtt</span><span class="p p-Indicator">:</span><span class="w"></span>
<a id="__codelineno-6-292" name="__codelineno-6-292" href="#__codelineno-6-292"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NatGatewayAEIP</span><span class="w"></span>
<a id="__codelineno-6-293" name="__codelineno-6-293" href="#__codelineno-6-293"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AllocationId</span><span class="w"></span>
<a id="__codelineno-6-294" name="__codelineno-6-294" href="#__codelineno-6-294"></a><span class="w">      </span><span class="nt">SubnetId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AppSubnet1</span><span class="w"></span>
<a id="__codelineno-6-295" name="__codelineno-6-295" href="#__codelineno-6-295"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-296" name="__codelineno-6-296" href="#__codelineno-6-296"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-297" name="__codelineno-6-297" href="#__codelineno-6-297"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;natgw&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;1a&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-298" name="__codelineno-6-298" href="#__codelineno-6-298"></a><span class="c1">###############################################</span><span class="w"></span>
<a id="__codelineno-6-299" name="__codelineno-6-299" href="#__codelineno-6-299"></a><span class="w">  </span><span class="nt">NatGatewayBEIP</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-300" name="__codelineno-6-300" href="#__codelineno-6-300"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;AWS::EC2::EIP&#39;</span><span class="w"></span>
<a id="__codelineno-6-301" name="__codelineno-6-301" href="#__codelineno-6-301"></a><span class="w">    </span><span class="nt">DependsOn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPCGatewayAttachment</span><span class="w">  </span>
<a id="__codelineno-6-302" name="__codelineno-6-302" href="#__codelineno-6-302"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-303" name="__codelineno-6-303" href="#__codelineno-6-303"></a><span class="w">      </span><span class="nt">Domain</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vpc</span><span class="w"></span>
<a id="__codelineno-6-304" name="__codelineno-6-304" href="#__codelineno-6-304"></a><span class="w">  </span><span class="nt">NatGatewayB</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-305" name="__codelineno-6-305" href="#__codelineno-6-305"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;AWS::EC2::NatGateway&#39;</span><span class="w"></span>
<a id="__codelineno-6-306" name="__codelineno-6-306" href="#__codelineno-6-306"></a><span class="w">    </span><span class="nt">DependsOn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NatGatewayBEIP</span><span class="w"> </span>
<a id="__codelineno-6-307" name="__codelineno-6-307" href="#__codelineno-6-307"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-308" name="__codelineno-6-308" href="#__codelineno-6-308"></a><span class="w">      </span><span class="nt">AllocationId</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-309" name="__codelineno-6-309" href="#__codelineno-6-309"></a><span class="w">          </span><span class="l l-Scalar l-Scalar-Plain">Fn::GetAtt</span><span class="p p-Indicator">:</span><span class="w"></span>
<a id="__codelineno-6-310" name="__codelineno-6-310" href="#__codelineno-6-310"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NatGatewayBEIP</span><span class="w"></span>
<a id="__codelineno-6-311" name="__codelineno-6-311" href="#__codelineno-6-311"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AllocationId</span><span class="w"></span>
<a id="__codelineno-6-312" name="__codelineno-6-312" href="#__codelineno-6-312"></a><span class="w">      </span><span class="nt">SubnetId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AppSubnet2</span><span class="w"></span>
<a id="__codelineno-6-313" name="__codelineno-6-313" href="#__codelineno-6-313"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-314" name="__codelineno-6-314" href="#__codelineno-6-314"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-315" name="__codelineno-6-315" href="#__codelineno-6-315"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;natgw&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;1b&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-316" name="__codelineno-6-316" href="#__codelineno-6-316"></a><span class="c1">###############################################</span><span class="w"></span>
<a id="__codelineno-6-317" name="__codelineno-6-317" href="#__codelineno-6-317"></a><span class="w">  </span><span class="nt">AppRouteTableARoute</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-318" name="__codelineno-6-318" href="#__codelineno-6-318"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;AWS::EC2::Route&#39;</span><span class="w"></span>
<a id="__codelineno-6-319" name="__codelineno-6-319" href="#__codelineno-6-319"></a><span class="w">    </span><span class="nt">DependsOn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPCGatewayAttachment</span><span class="w"></span>
<a id="__codelineno-6-320" name="__codelineno-6-320" href="#__codelineno-6-320"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-321" name="__codelineno-6-321" href="#__codelineno-6-321"></a><span class="w">      </span><span class="nt">RouteTableId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AppRouteTableA</span><span class="w"></span>
<a id="__codelineno-6-322" name="__codelineno-6-322" href="#__codelineno-6-322"></a><span class="w">      </span><span class="nt">DestinationCidrBlock</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.0.0.0/0&#39;</span><span class="w"></span>
<a id="__codelineno-6-323" name="__codelineno-6-323" href="#__codelineno-6-323"></a><span class="w">      </span><span class="nt">NatGatewayId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NatGatewayA</span><span class="w"></span>
<a id="__codelineno-6-324" name="__codelineno-6-324" href="#__codelineno-6-324"></a><span class="w">  </span><span class="nt">AppRouteTableBRoute</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-325" name="__codelineno-6-325" href="#__codelineno-6-325"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;AWS::EC2::Route&#39;</span><span class="w"></span>
<a id="__codelineno-6-326" name="__codelineno-6-326" href="#__codelineno-6-326"></a><span class="w">    </span><span class="nt">DependsOn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPCGatewayAttachment</span><span class="w"></span>
<a id="__codelineno-6-327" name="__codelineno-6-327" href="#__codelineno-6-327"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-328" name="__codelineno-6-328" href="#__codelineno-6-328"></a><span class="w">      </span><span class="nt">RouteTableId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AppRouteTableB</span><span class="w"></span>
<a id="__codelineno-6-329" name="__codelineno-6-329" href="#__codelineno-6-329"></a><span class="w">      </span><span class="nt">DestinationCidrBlock</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.0.0.0/0&#39;</span><span class="w"></span>
<a id="__codelineno-6-330" name="__codelineno-6-330" href="#__codelineno-6-330"></a><span class="w">      </span><span class="nt">NatGatewayId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NatGatewayB</span><span class="w"></span>
<a id="__codelineno-6-331" name="__codelineno-6-331" href="#__codelineno-6-331"></a>
<a id="__codelineno-6-332" name="__codelineno-6-332" href="#__codelineno-6-332"></a><span class="c1">###############################################</span><span class="w"></span>
<a id="__codelineno-6-333" name="__codelineno-6-333" href="#__codelineno-6-333"></a><span class="c1">### Local/Database Tier (local-access)     ####</span><span class="w"></span>
<a id="__codelineno-6-334" name="__codelineno-6-334" href="#__codelineno-6-334"></a><span class="c1">###############################################</span><span class="w"></span>
<a id="__codelineno-6-335" name="__codelineno-6-335" href="#__codelineno-6-335"></a><span class="w">  </span><span class="nt">BDRouteTableA</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-336" name="__codelineno-6-336" href="#__codelineno-6-336"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::RouteTable</span><span class="w"></span>
<a id="__codelineno-6-337" name="__codelineno-6-337" href="#__codelineno-6-337"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-338" name="__codelineno-6-338" href="#__codelineno-6-338"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-339" name="__codelineno-6-339" href="#__codelineno-6-339"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-340" name="__codelineno-6-340" href="#__codelineno-6-340"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;local&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;rt-1a&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-341" name="__codelineno-6-341" href="#__codelineno-6-341"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-342" name="__codelineno-6-342" href="#__codelineno-6-342"></a><span class="w">        </span><span class="nt">Ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-6-343" name="__codelineno-6-343" href="#__codelineno-6-343"></a><span class="w">  </span><span class="nt">BDRouteTableB</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-344" name="__codelineno-6-344" href="#__codelineno-6-344"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::RouteTable</span><span class="w"></span>
<a id="__codelineno-6-345" name="__codelineno-6-345" href="#__codelineno-6-345"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-346" name="__codelineno-6-346" href="#__codelineno-6-346"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-347" name="__codelineno-6-347" href="#__codelineno-6-347"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-348" name="__codelineno-6-348" href="#__codelineno-6-348"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;local&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;rt-1b&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-349" name="__codelineno-6-349" href="#__codelineno-6-349"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-350" name="__codelineno-6-350" href="#__codelineno-6-350"></a><span class="w">        </span><span class="nt">Ref</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w">          </span>
<a id="__codelineno-6-351" name="__codelineno-6-351" href="#__codelineno-6-351"></a><span class="c1">###############################################</span><span class="w"></span>
<a id="__codelineno-6-352" name="__codelineno-6-352" href="#__codelineno-6-352"></a><span class="w">  </span><span class="nt">BDSubnet1</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-353" name="__codelineno-6-353" href="#__codelineno-6-353"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet</span><span class="w"></span>
<a id="__codelineno-6-354" name="__codelineno-6-354" href="#__codelineno-6-354"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-355" name="__codelineno-6-355" href="#__codelineno-6-355"></a><span class="w">      </span><span class="nt">AvailabilityZone</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!GetAZs</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p p-Indicator">]</span><span class="w"></span>
<a id="__codelineno-6-356" name="__codelineno-6-356" href="#__codelineno-6-356"></a><span class="w">      </span><span class="nt">CidrBlock</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">8</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Cidr</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">CidrBlock</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">12</span><span class="p p-Indicator">,</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">SubnetBits</span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-357" name="__codelineno-6-357" href="#__codelineno-6-357"></a><span class="w">      </span><span class="nt">MapPublicIpOnLaunch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<a id="__codelineno-6-358" name="__codelineno-6-358" href="#__codelineno-6-358"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-359" name="__codelineno-6-359" href="#__codelineno-6-359"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-360" name="__codelineno-6-360" href="#__codelineno-6-360"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;local&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;subnet-1a&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-361" name="__codelineno-6-361" href="#__codelineno-6-361"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-6-362" name="__codelineno-6-362" href="#__codelineno-6-362"></a><span class="w">  </span><span class="nt">BDSubnet2</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-363" name="__codelineno-6-363" href="#__codelineno-6-363"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet</span><span class="w"></span>
<a id="__codelineno-6-364" name="__codelineno-6-364" href="#__codelineno-6-364"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-365" name="__codelineno-6-365" href="#__codelineno-6-365"></a><span class="w">      </span><span class="nt">AvailabilityZone</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!GetAZs</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p p-Indicator">]</span><span class="w">     </span>
<a id="__codelineno-6-366" name="__codelineno-6-366" href="#__codelineno-6-366"></a><span class="w">      </span><span class="nt">CidrBlock</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">9</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Cidr</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">CidrBlock</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">12</span><span class="p p-Indicator">,</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">SubnetBits</span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-367" name="__codelineno-6-367" href="#__codelineno-6-367"></a><span class="w">      </span><span class="nt">MapPublicIpOnLaunch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<a id="__codelineno-6-368" name="__codelineno-6-368" href="#__codelineno-6-368"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-369" name="__codelineno-6-369" href="#__codelineno-6-369"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-370" name="__codelineno-6-370" href="#__codelineno-6-370"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;local&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;subnet-1b&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-371" name="__codelineno-6-371" href="#__codelineno-6-371"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-6-372" name="__codelineno-6-372" href="#__codelineno-6-372"></a><span class="w">  </span><span class="nt">BDSubnet3</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-373" name="__codelineno-6-373" href="#__codelineno-6-373"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet</span><span class="w"></span>
<a id="__codelineno-6-374" name="__codelineno-6-374" href="#__codelineno-6-374"></a><span class="w">    </span><span class="nt">Condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build4AZs</span><span class="w"></span>
<a id="__codelineno-6-375" name="__codelineno-6-375" href="#__codelineno-6-375"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-376" name="__codelineno-6-376" href="#__codelineno-6-376"></a><span class="w">      </span><span class="nt">AvailabilityZone</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!GetAZs</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p p-Indicator">]</span><span class="w"></span>
<a id="__codelineno-6-377" name="__codelineno-6-377" href="#__codelineno-6-377"></a><span class="w">      </span><span class="nt">CidrBlock</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">10</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Cidr</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">CidrBlock</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">12</span><span class="p p-Indicator">,</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">SubnetBits</span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-378" name="__codelineno-6-378" href="#__codelineno-6-378"></a><span class="w">      </span><span class="nt">MapPublicIpOnLaunch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<a id="__codelineno-6-379" name="__codelineno-6-379" href="#__codelineno-6-379"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-380" name="__codelineno-6-380" href="#__codelineno-6-380"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-381" name="__codelineno-6-381" href="#__codelineno-6-381"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;local&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;subnet-1c&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-382" name="__codelineno-6-382" href="#__codelineno-6-382"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-6-383" name="__codelineno-6-383" href="#__codelineno-6-383"></a><span class="w">  </span><span class="nt">BDSubnet4</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-384" name="__codelineno-6-384" href="#__codelineno-6-384"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet</span><span class="w"></span>
<a id="__codelineno-6-385" name="__codelineno-6-385" href="#__codelineno-6-385"></a><span class="w">    </span><span class="nt">Condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build4AZs</span><span class="w"></span>
<a id="__codelineno-6-386" name="__codelineno-6-386" href="#__codelineno-6-386"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-387" name="__codelineno-6-387" href="#__codelineno-6-387"></a><span class="w">      </span><span class="nt">AvailabilityZone</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!GetAZs</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p p-Indicator">]</span><span class="w">     </span>
<a id="__codelineno-6-388" name="__codelineno-6-388" href="#__codelineno-6-388"></a><span class="w">      </span><span class="nt">CidrBlock</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">11</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Cidr</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">CidrBlock</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">12</span><span class="p p-Indicator">,</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">SubnetBits</span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-389" name="__codelineno-6-389" href="#__codelineno-6-389"></a><span class="w">      </span><span class="nt">MapPublicIpOnLaunch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<a id="__codelineno-6-390" name="__codelineno-6-390" href="#__codelineno-6-390"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-391" name="__codelineno-6-391" href="#__codelineno-6-391"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-6-392" name="__codelineno-6-392" href="#__codelineno-6-392"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;local&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;subnet-1d&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-6-393" name="__codelineno-6-393" href="#__codelineno-6-393"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-6-394" name="__codelineno-6-394" href="#__codelineno-6-394"></a><span class="c1">###############################################</span><span class="w"></span>
<a id="__codelineno-6-395" name="__codelineno-6-395" href="#__codelineno-6-395"></a><span class="w">  </span><span class="nt">BDSubnetAssoc1</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-396" name="__codelineno-6-396" href="#__codelineno-6-396"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::SubnetRouteTableAssociation</span><span class="w"></span>
<a id="__codelineno-6-397" name="__codelineno-6-397" href="#__codelineno-6-397"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-398" name="__codelineno-6-398" href="#__codelineno-6-398"></a><span class="w">      </span><span class="nt">RouteTableId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BDRouteTableA</span><span class="w"></span>
<a id="__codelineno-6-399" name="__codelineno-6-399" href="#__codelineno-6-399"></a><span class="w">      </span><span class="nt">SubnetId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BDSubnet1</span><span class="w"></span>
<a id="__codelineno-6-400" name="__codelineno-6-400" href="#__codelineno-6-400"></a><span class="w">  </span><span class="nt">BDSubnetAssoc2</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-401" name="__codelineno-6-401" href="#__codelineno-6-401"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::SubnetRouteTableAssociation</span><span class="w"></span>
<a id="__codelineno-6-402" name="__codelineno-6-402" href="#__codelineno-6-402"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-403" name="__codelineno-6-403" href="#__codelineno-6-403"></a><span class="w">      </span><span class="nt">RouteTableId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BDRouteTableB</span><span class="w"></span>
<a id="__codelineno-6-404" name="__codelineno-6-404" href="#__codelineno-6-404"></a><span class="w">      </span><span class="nt">SubnetId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BDSubnet2</span><span class="w"></span>
<a id="__codelineno-6-405" name="__codelineno-6-405" href="#__codelineno-6-405"></a><span class="w">  </span><span class="nt">BDSubnetAssoc3</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-406" name="__codelineno-6-406" href="#__codelineno-6-406"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::SubnetRouteTableAssociation</span><span class="w"></span>
<a id="__codelineno-6-407" name="__codelineno-6-407" href="#__codelineno-6-407"></a><span class="w">    </span><span class="nt">Condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build4AZs</span><span class="w"></span>
<a id="__codelineno-6-408" name="__codelineno-6-408" href="#__codelineno-6-408"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-409" name="__codelineno-6-409" href="#__codelineno-6-409"></a><span class="w">      </span><span class="nt">RouteTableId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BDRouteTableA</span><span class="w"></span>
<a id="__codelineno-6-410" name="__codelineno-6-410" href="#__codelineno-6-410"></a><span class="w">      </span><span class="nt">SubnetId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BDSubnet3</span><span class="w"></span>
<a id="__codelineno-6-411" name="__codelineno-6-411" href="#__codelineno-6-411"></a><span class="w">  </span><span class="nt">BDSubnetAssoc4</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-412" name="__codelineno-6-412" href="#__codelineno-6-412"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::SubnetRouteTableAssociation</span><span class="w"></span>
<a id="__codelineno-6-413" name="__codelineno-6-413" href="#__codelineno-6-413"></a><span class="w">    </span><span class="nt">Condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build4AZs</span><span class="w"></span>
<a id="__codelineno-6-414" name="__codelineno-6-414" href="#__codelineno-6-414"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-415" name="__codelineno-6-415" href="#__codelineno-6-415"></a><span class="w">      </span><span class="nt">RouteTableId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BDRouteTableB</span><span class="w"></span>
<a id="__codelineno-6-416" name="__codelineno-6-416" href="#__codelineno-6-416"></a><span class="w">      </span><span class="nt">SubnetId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">BDSubnet4</span><span class="w"></span>
<a id="__codelineno-6-417" name="__codelineno-6-417" href="#__codelineno-6-417"></a><span class="c1">###############################################</span><span class="w"></span>
<a id="__codelineno-6-418" name="__codelineno-6-418" href="#__codelineno-6-418"></a><span class="w">  </span><span class="nt">PublicRouteTableRouteA</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-419" name="__codelineno-6-419" href="#__codelineno-6-419"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;AWS::EC2::Route&#39;</span><span class="w"></span>
<a id="__codelineno-6-420" name="__codelineno-6-420" href="#__codelineno-6-420"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-421" name="__codelineno-6-421" href="#__codelineno-6-421"></a><span class="w">      </span><span class="nt">RouteTableId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PublicRouteTableA</span><span class="w"></span>
<a id="__codelineno-6-422" name="__codelineno-6-422" href="#__codelineno-6-422"></a><span class="w">      </span><span class="nt">DestinationCidrBlock</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.0.0.0/0&#39;</span><span class="w"></span>
<a id="__codelineno-6-423" name="__codelineno-6-423" href="#__codelineno-6-423"></a><span class="w">      </span><span class="nt">GatewayId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">InternetGateway</span><span class="w"></span>
<a id="__codelineno-6-424" name="__codelineno-6-424" href="#__codelineno-6-424"></a><span class="w">  </span><span class="nt">PublicRouteTableRouteB</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-425" name="__codelineno-6-425" href="#__codelineno-6-425"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;AWS::EC2::Route&#39;</span><span class="w"></span>
<a id="__codelineno-6-426" name="__codelineno-6-426" href="#__codelineno-6-426"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-6-427" name="__codelineno-6-427" href="#__codelineno-6-427"></a><span class="w">      </span><span class="nt">RouteTableId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PublicRouteTableB</span><span class="w"></span>
<a id="__codelineno-6-428" name="__codelineno-6-428" href="#__codelineno-6-428"></a><span class="w">      </span><span class="nt">DestinationCidrBlock</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;0.0.0.0/0&#39;</span><span class="w"></span>
<a id="__codelineno-6-429" name="__codelineno-6-429" href="#__codelineno-6-429"></a><span class="w">      </span><span class="nt">GatewayId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">InternetGateway</span><span class="w"></span>
<a id="__codelineno-6-430" name="__codelineno-6-430" href="#__codelineno-6-430"></a><span class="err">````</span><span class="w"></span>
<a id="__codelineno-6-431" name="__codelineno-6-431" href="#__codelineno-6-431"></a>
<a id="__codelineno-6-432" name="__codelineno-6-432" href="#__codelineno-6-432"></a><span class="l l-Scalar l-Scalar-Plain">&lt;/div&gt;</span><span class="w"></span>
<a id="__codelineno-6-433" name="__codelineno-6-433" href="#__codelineno-6-433"></a>
<a id="__codelineno-6-434" name="__codelineno-6-434" href="#__codelineno-6-434"></a><span class="c1">#### Cloudformation Nested Functions</span><span class="w"></span>
<a id="__codelineno-6-435" name="__codelineno-6-435" href="#__codelineno-6-435"></a><span class="l l-Scalar l-Scalar-Plain">The above template is prone to error depending on the user inputs. Howerver there are complicated ways to reduce some of them.</span><span class="w"></span>
<a id="__codelineno-6-436" name="__codelineno-6-436" href="#__codelineno-6-436"></a>
<a id="__codelineno-6-437" name="__codelineno-6-437" href="#__codelineno-6-437"></a><span class="nt">* ***Problem***</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-438" name="__codelineno-6-438" href="#__codelineno-6-438"></a><span class="w">  </span><span class="nt">Assume user provides a CidrBlock</span><span class="p">:</span><span class="w"> </span><span class="err">```</span><span class="l l-Scalar l-Scalar-Plain">10.168.64.0/22``` and CidrBits:```8```. In order to generate enough Cidr Blocks for 4 AZs, the templace is requesting ```12``` smaller blocks. Since The ```/22``` CidrBlock only contains 4 ```/24&#39;s```, the cloudformation stack build will fail.</span><span class="w"></span>
<a id="__codelineno-6-439" name="__codelineno-6-439" href="#__codelineno-6-439"></a>
<a id="__codelineno-6-440" name="__codelineno-6-440" href="#__codelineno-6-440"></a><span class="nt">* ***Solution***</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-441" name="__codelineno-6-441" href="#__codelineno-6-441"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">One possible solution would be to pick from a list of ```AllowedValues``` in the ```Parameters`` section and use ```Conditions``` to set ```CidrBits``` based on user choice using nested conditions in ```resources```.</span><span class="w"></span>
<a id="__codelineno-6-442" name="__codelineno-6-442" href="#__codelineno-6-442"></a>
<a id="__codelineno-6-443" name="__codelineno-6-443" href="#__codelineno-6-443"></a><span class="err">```</span><span class="l l-Scalar l-Scalar-Plain">yaml</span><span class="w"></span>
<a id="__codelineno-6-444" name="__codelineno-6-444" href="#__codelineno-6-444"></a><span class="nt">Conditions</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-445" name="__codelineno-6-445" href="#__codelineno-6-445"></a><span class="w">  </span><span class="nt">CidrBit8</span><span class="p">:</span><span class="w">    </span><span class="kt">!Equals</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">Cidr</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"></span>
<a id="__codelineno-6-446" name="__codelineno-6-446" href="#__codelineno-6-446"></a><span class="w">  </span><span class="nt">CidrBit7</span><span class="p">:</span><span class="w">    </span><span class="kt">!Equals</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">Cidr</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">21</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"></span>
<a id="__codelineno-6-447" name="__codelineno-6-447" href="#__codelineno-6-447"></a><span class="w">  </span><span class="nt">CidrBit6</span><span class="p">:</span><span class="w">    </span><span class="kt">!Equals</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">Cidr</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">22</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"></span>
<a id="__codelineno-6-448" name="__codelineno-6-448" href="#__codelineno-6-448"></a>
<a id="__codelineno-6-449" name="__codelineno-6-449" href="#__codelineno-6-449"></a><span class="nt">Resources</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-6-450" name="__codelineno-6-450" href="#__codelineno-6-450"></a><span class="w">  </span><span class="kt">!If</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">CidrBit8</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">8</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!If</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">CidrBit7</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">7</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">6</span><span class="p p-Indicator">]]</span><span class="w"></span>
</code></pre></div>

* ```!If [CidrBit8, 8, !If [CidrBit7, 7, 6]]``` 
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a>    if CidrBit8 == True:
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a>      cidrBit == 8
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a>    elif CidrBit7 == True:
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a>      cidrBit == 7
<a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>    else:
<a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a>      cidrBit = 6
</code></pre></div>

###### Cloudformation Snippet

<div style="width:1200px;height:600px;overflow:auto;">

<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="nt">AWSTemplateFormatVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2010-09-09</span><span class="w"></span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">GTZ Three Tier VPC Template</span><span class="w"></span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="nt">Metadata</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">AWS::CloudFormation::Interface</span><span class="p p-Indicator">:</span><span class="w"> </span>
<a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="w">    </span><span class="nt">ParameterGroups</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Label</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">          </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Stack</span><span class="nv"> </span><span class="s">Name</span><span class="nv"> </span><span class="s">-</span><span class="nv"> </span><span class="s">--three-tier-vpc-cf</span><span class="nv"> </span><span class="s">(i.e</span><span class="nv"> </span><span class="s">jira-dev-three-tier-vpc-cf)&quot;</span><span class="w"></span>
<a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Label</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">          </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;|&quot;</span><span class="w"></span>
<a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Label</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="w">          </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;VPC</span><span class="nv"> </span><span class="s">Configuration&quot;</span><span class="w"></span>
<a id="__codelineno-8-12" name="__codelineno-8-12" href="#__codelineno-8-12"></a><span class="w">        </span><span class="nt">Parameters</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-13" name="__codelineno-8-13" href="#__codelineno-8-13"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ProjectName</span><span class="w"></span>
<a id="__codelineno-8-14" name="__codelineno-8-14" href="#__codelineno-8-14"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Environment</span><span class="w">          </span>
<a id="__codelineno-8-15" name="__codelineno-8-15" href="#__codelineno-8-15"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CidrBlock</span><span class="w"></span>
<a id="__codelineno-8-16" name="__codelineno-8-16" href="#__codelineno-8-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Label</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-8-17" name="__codelineno-8-17" href="#__codelineno-8-17"></a><span class="w">          </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Subnet</span><span class="nv"> </span><span class="s">8</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">/24(/20</span><span class="nv"> </span><span class="s">CidrBlock</span><span class="nv"> </span><span class="s">Required),</span><span class="nv"> </span><span class="s">7</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">/25</span><span class="nv"> </span><span class="s">(/21</span><span class="nv"> </span><span class="s">CidrBlock</span><span class="nv"> </span><span class="s">Required),</span><span class="nv"> </span><span class="s">6</span><span class="nv"> </span><span class="s">=</span><span class="nv"> </span><span class="s">/26</span><span class="nv"> </span><span class="s">(/22</span><span class="nv"> </span><span class="s">CidrBlock</span><span class="nv"> </span><span class="s">Required)&quot;</span><span class="w"></span>
<a id="__codelineno-8-18" name="__codelineno-8-18" href="#__codelineno-8-18"></a><span class="w">        </span><span class="nt">Parameters</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-19" name="__codelineno-8-19" href="#__codelineno-8-19"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CidrMask</span><span class="w"></span>
<a id="__codelineno-8-20" name="__codelineno-8-20" href="#__codelineno-8-20"></a>
<a id="__codelineno-8-21" name="__codelineno-8-21" href="#__codelineno-8-21"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Label</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-8-22" name="__codelineno-8-22" href="#__codelineno-8-22"></a><span class="w">          </span><span class="nt">default</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Availability</span><span class="nv"> </span><span class="s">Zones&quot;</span><span class="w"></span>
<a id="__codelineno-8-23" name="__codelineno-8-23" href="#__codelineno-8-23"></a><span class="w">        </span><span class="nt">Parameters</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-24" name="__codelineno-8-24" href="#__codelineno-8-24"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NumberOfAZs</span><span class="w"></span>
<a id="__codelineno-8-25" name="__codelineno-8-25" href="#__codelineno-8-25"></a>
<a id="__codelineno-8-26" name="__codelineno-8-26" href="#__codelineno-8-26"></a><span class="nt">Parameters</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-27" name="__codelineno-8-27" href="#__codelineno-8-27"></a><span class="w">  </span><span class="nt">ProjectName</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-28" name="__codelineno-8-28" href="#__codelineno-8-28"></a><span class="w">    </span><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Project Name ( ex. jira /  sfpt / sec )</span><span class="w"></span>
<a id="__codelineno-8-29" name="__codelineno-8-29" href="#__codelineno-8-29"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">String</span><span class="w"></span>
<a id="__codelineno-8-30" name="__codelineno-8-30" href="#__codelineno-8-30"></a>
<a id="__codelineno-8-31" name="__codelineno-8-31" href="#__codelineno-8-31"></a><span class="w">  </span><span class="nt">CidrBlock1</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-32" name="__codelineno-8-32" href="#__codelineno-8-32"></a><span class="w">    </span><span class="nt">ConstraintDescription</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CIDR block parameter must be in the form x.x.x.x</span><span class="w"></span>
<a id="__codelineno-8-33" name="__codelineno-8-33" href="#__codelineno-8-33"></a><span class="w">    </span><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC valid IP Block ( ex. 10.168.0.0)</span><span class="w"></span>
<a id="__codelineno-8-34" name="__codelineno-8-34" href="#__codelineno-8-34"></a><span class="w">    </span><span class="nt">Default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10.168.0.0</span><span class="w"></span>
<a id="__codelineno-8-35" name="__codelineno-8-35" href="#__codelineno-8-35"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">String</span><span class="w"></span>
<a id="__codelineno-8-36" name="__codelineno-8-36" href="#__codelineno-8-36"></a>
<a id="__codelineno-8-37" name="__codelineno-8-37" href="#__codelineno-8-37"></a>
<a id="__codelineno-8-38" name="__codelineno-8-38" href="#__codelineno-8-38"></a><span class="w">  </span><span class="nt">Cidr</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-39" name="__codelineno-8-39" href="#__codelineno-8-39"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Number</span><span class="w"></span>
<a id="__codelineno-8-40" name="__codelineno-8-40" href="#__codelineno-8-40"></a><span class="w">    </span><span class="nt">AllowedValues</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-8-41" name="__codelineno-8-41" href="#__codelineno-8-41"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span><span class="w"></span>
<a id="__codelineno-8-42" name="__codelineno-8-42" href="#__codelineno-8-42"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">22</span><span class="w"></span>
<a id="__codelineno-8-43" name="__codelineno-8-43" href="#__codelineno-8-43"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">21</span><span class="w"></span>
<a id="__codelineno-8-44" name="__codelineno-8-44" href="#__codelineno-8-44"></a><span class="w">    </span><span class="nt">Default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20</span><span class="w"></span>
<a id="__codelineno-8-45" name="__codelineno-8-45" href="#__codelineno-8-45"></a><span class="w">    </span><span class="nt">Description</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">VPC valid IP CIDR Blocks /20&#39;s ( /24&#39;s smaller blocks )  , /21&#39;s ( /25&#39;s smaller blocks )and /22&#39;s ( /26&#39;s smaller blocks )</span><span class="w"></span>
<a id="__codelineno-8-46" name="__codelineno-8-46" href="#__codelineno-8-46"></a>
<a id="__codelineno-8-47" name="__codelineno-8-47" href="#__codelineno-8-47"></a><span class="w">  </span><span class="nt">NumberOfAZs</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-48" name="__codelineno-8-48" href="#__codelineno-8-48"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Number</span><span class="w"></span>
<a id="__codelineno-8-49" name="__codelineno-8-49" href="#__codelineno-8-49"></a><span class="w">    </span><span class="nt">AllowedValues</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-8-50" name="__codelineno-8-50" href="#__codelineno-8-50"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"></span>
<a id="__codelineno-8-51" name="__codelineno-8-51" href="#__codelineno-8-51"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span><span class="w"></span>
<a id="__codelineno-8-52" name="__codelineno-8-52" href="#__codelineno-8-52"></a><span class="w">    </span><span class="nt">Default</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"></span>
<a id="__codelineno-8-53" name="__codelineno-8-53" href="#__codelineno-8-53"></a><span class="w">    </span><span class="nt">Description</span><span class="p">:</span><span class="w">  </span><span class="l l-Scalar l-Scalar-Plain">Availability Zones - 2 = 2 per Tier, 4 = 4 per Tier</span><span class="w"></span>
<a id="__codelineno-8-54" name="__codelineno-8-54" href="#__codelineno-8-54"></a>
<a id="__codelineno-8-55" name="__codelineno-8-55" href="#__codelineno-8-55"></a><span class="w">  </span><span class="nt">Environment</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-56" name="__codelineno-8-56" href="#__codelineno-8-56"></a><span class="w">    </span><span class="nt">Description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Choose VPC Type</span><span class="w"> </span>
<a id="__codelineno-8-57" name="__codelineno-8-57" href="#__codelineno-8-57"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">String</span><span class="w"></span>
<a id="__codelineno-8-58" name="__codelineno-8-58" href="#__codelineno-8-58"></a><span class="w">    </span><span class="nt">AllowedValues</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-8-59" name="__codelineno-8-59" href="#__codelineno-8-59"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dev</span><span class="w"></span>
<a id="__codelineno-8-60" name="__codelineno-8-60" href="#__codelineno-8-60"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span><span class="w"></span>
<a id="__codelineno-8-61" name="__codelineno-8-61" href="#__codelineno-8-61"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prod</span><span class="w"></span>
<a id="__codelineno-8-62" name="__codelineno-8-62" href="#__codelineno-8-62"></a>
<a id="__codelineno-8-63" name="__codelineno-8-63" href="#__codelineno-8-63"></a><span class="nt">Conditions</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-8-64" name="__codelineno-8-64" href="#__codelineno-8-64"></a><span class="w">  </span><span class="nt">Build4AZs</span><span class="p">:</span><span class="w">    </span><span class="kt">!Equals</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">NumberOfAZs</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">4</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"></span>
<a id="__codelineno-8-65" name="__codelineno-8-65" href="#__codelineno-8-65"></a><span class="w">  </span><span class="nt">CidrBit8</span><span class="p">:</span><span class="w">    </span><span class="kt">!Equals</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">Cidr</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">20</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"></span>
<a id="__codelineno-8-66" name="__codelineno-8-66" href="#__codelineno-8-66"></a><span class="w">  </span><span class="nt">CidrBit7</span><span class="p">:</span><span class="w">    </span><span class="kt">!Equals</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">Cidr</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">21</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"></span>
<a id="__codelineno-8-67" name="__codelineno-8-67" href="#__codelineno-8-67"></a><span class="w">  </span><span class="nt">CidrBit6</span><span class="p">:</span><span class="w">    </span><span class="kt">!Equals</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">Cidr</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">22</span><span class="w"> </span><span class="p p-Indicator">]</span><span class="w"></span>
<a id="__codelineno-8-68" name="__codelineno-8-68" href="#__codelineno-8-68"></a>
<a id="__codelineno-8-69" name="__codelineno-8-69" href="#__codelineno-8-69"></a><span class="c1">###############################################</span><span class="w"></span>
<a id="__codelineno-8-70" name="__codelineno-8-70" href="#__codelineno-8-70"></a><span class="c1">### Three Tier VPC                         ####</span><span class="w"></span>
<a id="__codelineno-8-71" name="__codelineno-8-71" href="#__codelineno-8-71"></a><span class="c1">###############################################  </span><span class="w"></span>
<a id="__codelineno-8-72" name="__codelineno-8-72" href="#__codelineno-8-72"></a><span class="nt">Resources</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-73" name="__codelineno-8-73" href="#__codelineno-8-73"></a><span class="w">  </span><span class="nt">VPC</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-74" name="__codelineno-8-74" href="#__codelineno-8-74"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::VPC</span><span class="w"></span>
<a id="__codelineno-8-75" name="__codelineno-8-75" href="#__codelineno-8-75"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-76" name="__codelineno-8-76" href="#__codelineno-8-76"></a><span class="w">      </span><span class="nt">CidrBlock</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">CidrBlock1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">Cidr</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-8-77" name="__codelineno-8-77" href="#__codelineno-8-77"></a><span class="w">      </span><span class="nt">EnableDnsHostnames</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<a id="__codelineno-8-78" name="__codelineno-8-78" href="#__codelineno-8-78"></a><span class="w">      </span><span class="nt">EnableDnsSupport</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<a id="__codelineno-8-79" name="__codelineno-8-79" href="#__codelineno-8-79"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-80" name="__codelineno-8-80" href="#__codelineno-8-80"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-8-81" name="__codelineno-8-81" href="#__codelineno-8-81"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">Environment</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;three-tier&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;vpc&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-8-82" name="__codelineno-8-82" href="#__codelineno-8-82"></a>
<a id="__codelineno-8-83" name="__codelineno-8-83" href="#__codelineno-8-83"></a><span class="w">  </span><span class="nt">DhcpOptions</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-8-84" name="__codelineno-8-84" href="#__codelineno-8-84"></a><span class="w">      </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::DHCPOptions</span><span class="w"></span>
<a id="__codelineno-8-85" name="__codelineno-8-85" href="#__codelineno-8-85"></a><span class="w">      </span><span class="nt">Properties</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-8-86" name="__codelineno-8-86" href="#__codelineno-8-86"></a><span class="w">          </span><span class="nt">DomainName</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;three-tier.org&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-8-87" name="__codelineno-8-87" href="#__codelineno-8-87"></a><span class="w">          </span><span class="nt">DomainNameServers</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-8-88" name="__codelineno-8-88" href="#__codelineno-8-88"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AmazonProvidedDNS</span><span class="w"></span>
<a id="__codelineno-8-89" name="__codelineno-8-89" href="#__codelineno-8-89"></a><span class="w">          </span><span class="nt">Tags</span><span class="p">:</span><span class="w"> </span>
<a id="__codelineno-8-90" name="__codelineno-8-90" href="#__codelineno-8-90"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-8-91" name="__codelineno-8-91" href="#__codelineno-8-91"></a><span class="w">              </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">Environment</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;three-tier&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;dopt&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-8-92" name="__codelineno-8-92" href="#__codelineno-8-92"></a>
<a id="__codelineno-8-93" name="__codelineno-8-93" href="#__codelineno-8-93"></a><span class="w">  </span><span class="nt">VPCDHCPOptionsAssociation</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-94" name="__codelineno-8-94" href="#__codelineno-8-94"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::VPCDHCPOptionsAssociation</span><span class="w"></span>
<a id="__codelineno-8-95" name="__codelineno-8-95" href="#__codelineno-8-95"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-96" name="__codelineno-8-96" href="#__codelineno-8-96"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">Ref</span><span class="p">:</span><span class="w"> </span><span class="nv">VPC</span><span class="p p-Indicator">}</span><span class="w"></span>
<a id="__codelineno-8-97" name="__codelineno-8-97" href="#__codelineno-8-97"></a><span class="w">      </span><span class="nt">DhcpOptionsId</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="nt">Ref</span><span class="p">:</span><span class="w"> </span><span class="nv">DhcpOptions</span><span class="p p-Indicator">}</span><span class="w"></span>
<a id="__codelineno-8-98" name="__codelineno-8-98" href="#__codelineno-8-98"></a>
<a id="__codelineno-8-99" name="__codelineno-8-99" href="#__codelineno-8-99"></a><span class="w">  </span><span class="nt">InternetGateway</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-100" name="__codelineno-8-100" href="#__codelineno-8-100"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::InternetGateway</span><span class="w"></span>
<a id="__codelineno-8-101" name="__codelineno-8-101" href="#__codelineno-8-101"></a><span class="w">    </span><span class="nt">DependsOn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-8-102" name="__codelineno-8-102" href="#__codelineno-8-102"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-103" name="__codelineno-8-103" href="#__codelineno-8-103"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-104" name="__codelineno-8-104" href="#__codelineno-8-104"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-8-105" name="__codelineno-8-105" href="#__codelineno-8-105"></a><span class="w">        </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">Environment</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;three-tier&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;igw&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-8-106" name="__codelineno-8-106" href="#__codelineno-8-106"></a><span class="w">  </span><span class="nt">VPCGatewayAttachment</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-107" name="__codelineno-8-107" href="#__codelineno-8-107"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::VPCGatewayAttachment</span><span class="w"></span>
<a id="__codelineno-8-108" name="__codelineno-8-108" href="#__codelineno-8-108"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-109" name="__codelineno-8-109" href="#__codelineno-8-109"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-8-110" name="__codelineno-8-110" href="#__codelineno-8-110"></a><span class="w">      </span><span class="nt">InternetGatewayId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">InternetGateway</span><span class="w"></span>
<a id="__codelineno-8-111" name="__codelineno-8-111" href="#__codelineno-8-111"></a>
<a id="__codelineno-8-112" name="__codelineno-8-112" href="#__codelineno-8-112"></a><span class="c1">###############################################</span><span class="w"></span>
<a id="__codelineno-8-113" name="__codelineno-8-113" href="#__codelineno-8-113"></a><span class="c1">### Public/ALB Tier (inbound/outbound)     ####</span><span class="w"></span>
<a id="__codelineno-8-114" name="__codelineno-8-114" href="#__codelineno-8-114"></a><span class="c1">############################################### </span><span class="w"></span>
<a id="__codelineno-8-115" name="__codelineno-8-115" href="#__codelineno-8-115"></a><span class="w">  </span><span class="nt">PublicRouteTableA</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-116" name="__codelineno-8-116" href="#__codelineno-8-116"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::RouteTable</span><span class="w"></span>
<a id="__codelineno-8-117" name="__codelineno-8-117" href="#__codelineno-8-117"></a><span class="w">    </span><span class="nt">DependsOn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPCGatewayAttachment</span><span class="w"></span>
<a id="__codelineno-8-118" name="__codelineno-8-118" href="#__codelineno-8-118"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-119" name="__codelineno-8-119" href="#__codelineno-8-119"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-120" name="__codelineno-8-120" href="#__codelineno-8-120"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-8-121" name="__codelineno-8-121" href="#__codelineno-8-121"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;public&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;rt-1a&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-8-122" name="__codelineno-8-122" href="#__codelineno-8-122"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-8-123" name="__codelineno-8-123" href="#__codelineno-8-123"></a><span class="w">  </span><span class="nt">PublicRouteTableB</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-124" name="__codelineno-8-124" href="#__codelineno-8-124"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::RouteTable</span><span class="w"></span>
<a id="__codelineno-8-125" name="__codelineno-8-125" href="#__codelineno-8-125"></a><span class="w">    </span><span class="nt">DependsOn</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPCGatewayAttachment</span><span class="w"></span>
<a id="__codelineno-8-126" name="__codelineno-8-126" href="#__codelineno-8-126"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-127" name="__codelineno-8-127" href="#__codelineno-8-127"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-128" name="__codelineno-8-128" href="#__codelineno-8-128"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-8-129" name="__codelineno-8-129" href="#__codelineno-8-129"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;public&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;rt-1b&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-8-130" name="__codelineno-8-130" href="#__codelineno-8-130"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w">       </span>
<a id="__codelineno-8-131" name="__codelineno-8-131" href="#__codelineno-8-131"></a><span class="c1">###############################################</span><span class="w"></span>
<a id="__codelineno-8-132" name="__codelineno-8-132" href="#__codelineno-8-132"></a><span class="w">  </span><span class="nt">PublicSubnet1</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-133" name="__codelineno-8-133" href="#__codelineno-8-133"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet</span><span class="w"></span>
<a id="__codelineno-8-134" name="__codelineno-8-134" href="#__codelineno-8-134"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-135" name="__codelineno-8-135" href="#__codelineno-8-135"></a><span class="w">      </span><span class="nt">AvailabilityZone</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!GetAZs</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p p-Indicator">]</span><span class="w"></span>
<a id="__codelineno-8-136" name="__codelineno-8-136" href="#__codelineno-8-136"></a><span class="w">      </span><span class="nt">CidrBlock</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">0</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Cidr</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">CidrBlock1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">Cidr</span><span class="w"> </span><span class="p p-Indicator">]],</span><span class="w"> </span><span class="nv">12</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!If</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">CidrBit8</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">8</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!If</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">CidrBit7</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">7</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">6</span><span class="p p-Indicator">]]]]</span><span class="w"></span>
<a id="__codelineno-8-137" name="__codelineno-8-137" href="#__codelineno-8-137"></a><span class="w">      </span><span class="nt">MapPublicIpOnLaunch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<a id="__codelineno-8-138" name="__codelineno-8-138" href="#__codelineno-8-138"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-139" name="__codelineno-8-139" href="#__codelineno-8-139"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-8-140" name="__codelineno-8-140" href="#__codelineno-8-140"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;public&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;subnet-1a&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-8-141" name="__codelineno-8-141" href="#__codelineno-8-141"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-8-142" name="__codelineno-8-142" href="#__codelineno-8-142"></a><span class="w">  </span><span class="nt">PublicSubnet2</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-143" name="__codelineno-8-143" href="#__codelineno-8-143"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet</span><span class="w"></span>
<a id="__codelineno-8-144" name="__codelineno-8-144" href="#__codelineno-8-144"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-145" name="__codelineno-8-145" href="#__codelineno-8-145"></a><span class="w">      </span><span class="nt">AvailabilityZone</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!GetAZs</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p p-Indicator">]</span><span class="w">     </span>
<a id="__codelineno-8-146" name="__codelineno-8-146" href="#__codelineno-8-146"></a><span class="w">      </span><span class="nt">CidrBlock</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Cidr</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">CidrBlock1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">Cidr</span><span class="w"> </span><span class="p p-Indicator">]],</span><span class="w"> </span><span class="nv">12</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!If</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">CidrBit8</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">8</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!If</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">CidrBit7</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">7</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">6</span><span class="p p-Indicator">]]]]</span><span class="w"></span>
<a id="__codelineno-8-147" name="__codelineno-8-147" href="#__codelineno-8-147"></a><span class="w">      </span><span class="nt">MapPublicIpOnLaunch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<a id="__codelineno-8-148" name="__codelineno-8-148" href="#__codelineno-8-148"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-149" name="__codelineno-8-149" href="#__codelineno-8-149"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-8-150" name="__codelineno-8-150" href="#__codelineno-8-150"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;public&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;subnet-1b&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-8-151" name="__codelineno-8-151" href="#__codelineno-8-151"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-8-152" name="__codelineno-8-152" href="#__codelineno-8-152"></a><span class="w">  </span><span class="nt">PublicSubnet3</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-153" name="__codelineno-8-153" href="#__codelineno-8-153"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet</span><span class="w"></span>
<a id="__codelineno-8-154" name="__codelineno-8-154" href="#__codelineno-8-154"></a><span class="w">    </span><span class="nt">Condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build4AZs</span><span class="w"></span>
<a id="__codelineno-8-155" name="__codelineno-8-155" href="#__codelineno-8-155"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-156" name="__codelineno-8-156" href="#__codelineno-8-156"></a><span class="w">      </span><span class="nt">AvailabilityZone</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!GetAZs</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p p-Indicator">]</span><span class="w"></span>
<a id="__codelineno-8-157" name="__codelineno-8-157" href="#__codelineno-8-157"></a><span class="w">      </span><span class="nt">CidrBlock</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">2</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Cidr</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">CidrBlock1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">Cidr</span><span class="w"> </span><span class="p p-Indicator">]],</span><span class="w"> </span><span class="nv">12</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!If</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">CidrBit8</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">8</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!If</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">CidrBit7</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">7</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">6</span><span class="p p-Indicator">]]]]</span><span class="w"></span>
<a id="__codelineno-8-158" name="__codelineno-8-158" href="#__codelineno-8-158"></a><span class="w">      </span><span class="nt">MapPublicIpOnLaunch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<a id="__codelineno-8-159" name="__codelineno-8-159" href="#__codelineno-8-159"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-160" name="__codelineno-8-160" href="#__codelineno-8-160"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-8-161" name="__codelineno-8-161" href="#__codelineno-8-161"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;public&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;subnet-1c&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-8-162" name="__codelineno-8-162" href="#__codelineno-8-162"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-8-163" name="__codelineno-8-163" href="#__codelineno-8-163"></a><span class="w">  </span><span class="nt">PublicSubnet4</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-164" name="__codelineno-8-164" href="#__codelineno-8-164"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::Subnet</span><span class="w"></span>
<a id="__codelineno-8-165" name="__codelineno-8-165" href="#__codelineno-8-165"></a><span class="w">    </span><span class="nt">Condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build4AZs</span><span class="w"></span>
<a id="__codelineno-8-166" name="__codelineno-8-166" href="#__codelineno-8-166"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-167" name="__codelineno-8-167" href="#__codelineno-8-167"></a><span class="w">      </span><span class="nt">AvailabilityZone</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!GetAZs</span><span class="w"> </span><span class="s">&#39;&#39;</span><span class="p p-Indicator">]</span><span class="w">     </span>
<a id="__codelineno-8-168" name="__codelineno-8-168" href="#__codelineno-8-168"></a><span class="w">      </span><span class="nt">CidrBlock</span><span class="p">:</span><span class="w"> </span><span class="kt">!Select</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="nv">3</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Cidr</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">CidrBlock1</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;/&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">Cidr</span><span class="w"> </span><span class="p p-Indicator">]],</span><span class="w"> </span><span class="nv">12</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!If</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">CidrBit8</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">8</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="kt">!If</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">CidrBit7</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">7</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="nv">6</span><span class="p p-Indicator">]]]]</span><span class="w"></span>
<a id="__codelineno-8-169" name="__codelineno-8-169" href="#__codelineno-8-169"></a><span class="w">      </span><span class="nt">MapPublicIpOnLaunch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w"></span>
<a id="__codelineno-8-170" name="__codelineno-8-170" href="#__codelineno-8-170"></a><span class="w">      </span><span class="nt">Tags</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-171" name="__codelineno-8-171" href="#__codelineno-8-171"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">Key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Name</span><span class="w"></span>
<a id="__codelineno-8-172" name="__codelineno-8-172" href="#__codelineno-8-172"></a><span class="w">          </span><span class="nt">Value</span><span class="p">:</span><span class="w"> </span><span class="kt">!Join</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&#39;-&#39;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="kt">!Ref</span><span class="w"> </span><span class="nv">ProjectName</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;public&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;subnet-1d&quot;</span><span class="w"> </span><span class="p p-Indicator">]]</span><span class="w"></span>
<a id="__codelineno-8-173" name="__codelineno-8-173" href="#__codelineno-8-173"></a><span class="w">      </span><span class="nt">VpcId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VPC</span><span class="w"></span>
<a id="__codelineno-8-174" name="__codelineno-8-174" href="#__codelineno-8-174"></a><span class="c1">###############################################</span><span class="w"></span>
<a id="__codelineno-8-175" name="__codelineno-8-175" href="#__codelineno-8-175"></a><span class="w">  </span><span class="nt">PublicSubnetAssoc1</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-176" name="__codelineno-8-176" href="#__codelineno-8-176"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::SubnetRouteTableAssociation</span><span class="w"></span>
<a id="__codelineno-8-177" name="__codelineno-8-177" href="#__codelineno-8-177"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-178" name="__codelineno-8-178" href="#__codelineno-8-178"></a><span class="w">      </span><span class="nt">RouteTableId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PublicRouteTableA</span><span class="w"></span>
<a id="__codelineno-8-179" name="__codelineno-8-179" href="#__codelineno-8-179"></a><span class="w">      </span><span class="nt">SubnetId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PublicSubnet1</span><span class="w"></span>
<a id="__codelineno-8-180" name="__codelineno-8-180" href="#__codelineno-8-180"></a><span class="w">  </span><span class="nt">PublicSubnetAssoc2</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-181" name="__codelineno-8-181" href="#__codelineno-8-181"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::SubnetRouteTableAssociation</span><span class="w"></span>
<a id="__codelineno-8-182" name="__codelineno-8-182" href="#__codelineno-8-182"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-183" name="__codelineno-8-183" href="#__codelineno-8-183"></a><span class="w">      </span><span class="nt">RouteTableId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PublicRouteTableB</span><span class="w"></span>
<a id="__codelineno-8-184" name="__codelineno-8-184" href="#__codelineno-8-184"></a><span class="w">      </span><span class="nt">SubnetId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PublicSubnet2</span><span class="w"></span>
<a id="__codelineno-8-185" name="__codelineno-8-185" href="#__codelineno-8-185"></a><span class="w">  </span><span class="nt">PublicSubnetAssoc3</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-186" name="__codelineno-8-186" href="#__codelineno-8-186"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::SubnetRouteTableAssociation</span><span class="w"></span>
<a id="__codelineno-8-187" name="__codelineno-8-187" href="#__codelineno-8-187"></a><span class="w">    </span><span class="nt">Condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build4AZs</span><span class="w"></span>
<a id="__codelineno-8-188" name="__codelineno-8-188" href="#__codelineno-8-188"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-189" name="__codelineno-8-189" href="#__codelineno-8-189"></a><span class="w">      </span><span class="nt">RouteTableId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PublicRouteTableA</span><span class="w"></span>
<a id="__codelineno-8-190" name="__codelineno-8-190" href="#__codelineno-8-190"></a><span class="w">      </span><span class="nt">SubnetId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PublicSubnet3</span><span class="w"></span>
<a id="__codelineno-8-191" name="__codelineno-8-191" href="#__codelineno-8-191"></a><span class="w">  </span><span class="nt">PublicSubnetAssoc4</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-192" name="__codelineno-8-192" href="#__codelineno-8-192"></a><span class="w">    </span><span class="nt">Type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">AWS::EC2::SubnetRouteTableAssociation</span><span class="w"></span>
<a id="__codelineno-8-193" name="__codelineno-8-193" href="#__codelineno-8-193"></a><span class="w">    </span><span class="nt">Condition</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Build4AZs</span><span class="w"></span>
<a id="__codelineno-8-194" name="__codelineno-8-194" href="#__codelineno-8-194"></a><span class="w">    </span><span class="nt">Properties</span><span class="p">:</span><span class="w"></span>
<a id="__codelineno-8-195" name="__codelineno-8-195" href="#__codelineno-8-195"></a><span class="w">      </span><span class="nt">RouteTableId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PublicRouteTableB</span><span class="w"></span>
<a id="__codelineno-8-196" name="__codelineno-8-196" href="#__codelineno-8-196"></a><span class="w">      </span><span class="nt">SubnetId</span><span class="p">:</span><span class="w"> </span><span class="kt">!Ref</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PublicSubnet4</span><span class="w"></span>
</code></pre></div>
</div><script type="text/javascript" src="https://viewer.diagrams.net/js/viewer-static.min.js"></script>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../plugin-test/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Plugin test" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Plugin test
            </div>
          </div>
        </a>
      
      
        
        <a href="../../azure/intro/" class="md-footer__link md-footer__link--next" aria-label="Next: Introduction" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Introduction
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright 2022 <a href='https://gtz4all.github.io'>Gtz4All</a>. All Rights Reserved.
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
      
      
    
    <a href="https://gtz4all.github.io/" target="_blank" rel="noopener" title="gtz4all.github.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8h5Z"/></svg>
    </a>
  
    
    
      
      
    
    <a href="https://github.com/gtz4all" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2A10 10 0 0 0 2 12c0 4.42 2.87 8.17 6.84 9.5.5.08.66-.23.66-.5v-1.69c-2.77.6-3.36-1.34-3.36-1.34-.46-1.16-1.11-1.47-1.11-1.47-.91-.62.07-.6.07-.6 1 .07 1.53 1.03 1.53 1.03.87 1.52 2.34 1.07 2.91.83.09-.65.35-1.09.63-1.34-2.22-.25-4.55-1.11-4.55-4.92 0-1.11.38-2 1.03-2.71-.1-.25-.45-1.29.1-2.64 0 0 .84-.27 2.75 1.02.79-.22 1.65-.33 2.5-.33.85 0 1.71.11 2.5.33 1.91-1.29 2.75-1.02 2.75-1.02.55 1.35.2 2.39.1 2.64.65.71 1.03 1.6 1.03 2.71 0 3.82-2.34 4.66-4.57 4.91.36.31.69.92.69 1.85V21c0 .27.16.59.67.5C19.14 20.16 22 16.42 22 12A10 10 0 0 0 12 2Z"/></svg>
    </a>
  
    
    
    <a href="gtz4all@gmail.com" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "header.autohide", "navigation.prune"], "search": "../../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.078830c0.min.js"></script>
      
    
  </body>
</html>